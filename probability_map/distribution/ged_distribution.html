<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>GED â€“ Generalized Error Distribution</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}]});"></script>
  <style>
    :root{ --bg:#f5f7f9; --panel:#ffffff; --ink:#111; --muted:#555; --border:#dcdcdc; --accent:#8b5cf6; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial; color:var(--ink); background:var(--bg)}
    header{padding:10px 18px; background:var(--accent); color:#fff; font-weight:600}

    .wrap{max-width:1150px; margin:14px auto; padding:0 14px; display:grid; grid-template-columns: 340px 1fr; grid-template-rows: auto auto; gap:14px}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:12px}

    .row{display:flex; align-items:center; gap:8px; margin:6px 0; flex-wrap:wrap}
    label{min-width:24px; color:#333; font-weight:600}
    input[type="range"]{width:90px}
    input[type="number"]{width:60px; padding:5px 6px; border:1px solid var(--border); border-radius:6px; font-size:13px}
    .note{color:var(--muted); font-size:12px}
    .kblock{background:#fff; border:1px solid var(--border); border-radius:10px; padding:10px; margin-top:10px}

    .plot-card{grid-column:2; grid-row:1}
    .plot{background:#fff; border:1px solid var(--border); border-radius:12px; padding:10px}
    canvas{width:100%; height:280px; display:block; background:#fafafa; border-radius:8px}

    .stats-bar{display:flex; justify-content:center; gap:16px; padding:8px; background:#f3e8ff; border-radius:8px; margin-top:10px; font-size:13px; flex-wrap:wrap}
    .stat-item{text-align:center}
    .stat-label{color:var(--muted); font-size:11px}
    .stat-value{font-weight:600; color:var(--accent)}

    .table-card{grid-column:1; grid-row:2; display:flex; flex-direction:column; max-height:320px}
    .table-container{overflow-y:auto; border:1px solid var(--border); border-radius:8px; margin-top:10px; flex:1}
    table.pmf-table{width:100%; border-collapse:collapse; font-size:13px; text-align:right}
    .pmf-table th{position:sticky; top:0; background:#f3e8ff; padding:8px; border-bottom:1px solid var(--border); text-align:right; font-weight:600; color:var(--accent); z-index:10}
    .pmf-table td{padding:6px 8px; border-bottom:1px solid #eee}
    .pmf-table tr:hover{background:#faf5ff}
    .prob-bar-bg{width:100%; height:4px; background:#e5e7eb; margin-top:2px; border-radius:2px; overflow:hidden}
    .prob-bar-fill{height:100%; background:var(--accent)}

    .calc-card{grid-column:2; grid-row:2}
    .calc-grid{display:grid; grid-template-columns: repeat(3, 1fr); gap:12px}
    @media (max-width: 1100px) { .calc-grid{grid-template-columns: 1fr} }
    .calc-box{background:#fafafa; border:1px solid var(--border); border-radius:10px; padding:12px}
    .calc-box h4{font-size:13px; color:var(--accent); margin:0 0 10px 0; display:flex; align-items:center; gap:6px}
    .calc-box h4 code{background:#f3e8ff; padding:2px 6px; border-radius:4px; font-size:12px}
    .calc-row{display:flex; align-items:center; gap:8px; margin:8px 0}
    .calc-row label{font-size:13px; color:var(--muted); min-width:50px}
    .calc-row input{flex:1; padding:8px 10px; border:1px solid var(--border); border-radius:6px; font-size:13px}
    .calc-row .result{flex:1; padding:8px 10px; background:#fff; border:1px solid var(--accent); border-radius:6px; font-weight:600; color:var(--accent); font-size:13px}
    .calc-btn{width:100%; padding:6px; background:var(--accent); color:#fff; border:none; border-radius:6px; font-weight:600; cursor:pointer; margin-top:8px; font-size:13px}
    .calc-btn:hover{background:#7c3aed}

    @media (max-width: 900px){ 
      .wrap{grid-template-columns: 1fr} 
      .plot-card{grid-column:1; grid-row:2}
      .table-card{grid-column:1; grid-row:3}
      .calc-card{grid-column:1; grid-row:4}
    }
  </style>
</head>
<body>
<header>Generalized Error Distribution (GED) $X \sim \text{GED}(\mu, \alpha, \beta)$</header>

<main class="wrap">
  <section class="card">
    <div class="row">
      <label>$\mu$</label>
      <input id="mu" type="range" min="-3" max="3" step="0.1" value="0">
      <input id="muNum" type="number" min="-5" max="5" step="0.1" value="0">
      <span class="note">(location)</span>
    </div>
    <div class="row">
      <label>$\alpha$</label>
      <input id="alpha" type="range" min="0.3" max="3" step="0.1" value="1">
      <input id="alphaNum" type="number" min="0.1" max="5" step="0.1" value="1">
      <span class="note">(scale)</span>
    </div>
    <div class="row">
      <label>$\beta$</label>
      <input id="beta" type="range" min="0.5" max="5" step="0.1" value="2">
      <input id="betaNum" type="number" min="0.3" max="10" step="0.1" value="2">
      <span class="note">(shape)</span>
    </div>

    <div class="kblock">
      <div class="note" style="font-weight:600; margin-bottom:6px">Probability Density Function (PDF)</div>
      <div style="text-align:center; padding:6px 0; font-size:0.95em">
        $$f(x) = \frac{\beta}{2\alpha\Gamma(1/\beta)} e^{-\left|\frac{x-\mu}{\alpha}\right|^\beta}$$
      </div>
    </div>

    <div class="kblock">
      <div class="note" style="font-weight:600; margin-bottom:6px">Properties</div>
      <table style="width:100%; font-size:12px">
        <tr><td style="color:var(--muted)">Mean</td><td>$\mu$</td></tr>
        <tr><td style="color:var(--muted)">Variance</td><td>$\alpha^2 \frac{\Gamma(3/\beta)}{\Gamma(1/\beta)}$</td></tr>
      </table>
    </div>

    <div class="kblock">
      <div class="note" style="font-weight:600; margin-bottom:6px">Special Cases</div>
      <div style="font-size:11px; color:var(--muted)">
        â€¢ $\beta=1$: Laplace<br>
        â€¢ $\beta=2$: Normal<br>
        â€¢ $\beta \to \infty$: Uniform
      </div>
    </div>
  </section>

  <section class="card plot-card">
    <div class="plot">
      <h3 style="margin:0 0 6px 0; font-size:14px">PDF Visualization</h3>
      <canvas id="pdfCanvas"></canvas>
      <div class="stats-bar">
        <div class="stat-item"><div class="stat-label">$\mu$</div><div class="stat-value" id="muOut">0.00</div></div>
        <div class="stat-item"><div class="stat-label">$\alpha$</div><div class="stat-value" id="alphaOut">1.00</div></div>
        <div class="stat-item"><div class="stat-label">$\beta$</div><div class="stat-value" id="betaOut">2.00</div></div>
        <div class="stat-item"><div class="stat-label">$E[X]$</div><div class="stat-value" id="meanOut">0.00</div></div>
        <div class="stat-item"><div class="stat-label">$\text{Var}[X]$</div><div class="stat-value" id="varOut">0.50</div></div>
      </div>
    </div>
  </section>

  <section class="card table-card">
    <h4 style="margin:0 0 10px 0; font-size:14px; color:var(--accent)">ðŸ“‹ PDF Table (Key Quantiles)</h4>
    <div class="note" style="margin-bottom:6px">Values at common percentiles.</div>
    <div class="table-container">
      <table class="pmf-table">
        <thead>
          <tr>
            <th style="text-align:center; width:60px">x</th>
            <th>f(x)</th>
            <th>F(x)</th>
          </tr>
        </thead>
        <tbody id="pdfTableBody"></tbody>
      </table>
    </div>
  </section>

  <section class="card calc-card">
    <h3 style="margin:0 0 14px 0; font-size:15px; color:var(--accent)">ðŸ“Š Calculator</h3>
    <div class="calc-grid">
      <div class="calc-box">
        <h4><code>dged(x)</code> Density</h4>
        <div class="calc-row"><label>x =</label><input type="number" id="d_x" value="0" step="0.1"></div>
        <button class="calc-btn" onclick="calcD()">Calc f(x)</button>
        <div class="calc-row"><label>f(x) =</label><div class="result" id="d_res">â€”</div></div>
      </div>
      <div class="calc-box">
        <h4><code>pged(x)</code> CDF</h4>
        <div class="calc-row"><label>x =</label><input type="number" id="p_x" value="0" step="0.1"></div>
        <button class="calc-btn" onclick="calcP()">Calc P(Xâ‰¤x)</button>
        <div class="calc-row"><label>Prob =</label><div class="result" id="p_res">â€”</div></div>
      </div>
      <div class="calc-box">
        <h4><code>qged(p)</code> Quantile</h4>
        <div class="calc-row"><label>p =</label><input type="number" id="q_p" value="0.5" min="0" max="1" step="0.01"></div>
        <button class="calc-btn" onclick="calcQ()">Calc x</button>
        <div class="calc-row"><label>x =</label><div class="result" id="q_res">â€”</div></div>
      </div>
    </div>
  </section>
</main>

<script>
let mu = 0, alpha = 1, beta = 2;
const canvas = document.getElementById('pdfCanvas');

function gammafn(z) {
  const g = 7, p = [0.99999999999980993,676.5203681218851,-1259.1392167224028,771.32342877765313,-176.61502916214059,12.507343278686905,-0.13857109526572012,9.9843695780195716e-6,1.5056327351493116e-7];
  if (z < 0.5) return Math.PI / (Math.sin(Math.PI * z) * gammafn(1 - z));
  z -= 1; let x = p[0];
  for (let i = 1; i < p.length; i++) x += p[i] / (z + i);
  const t = z + g + 0.5;
  return Math.sqrt(2 * Math.PI) * Math.pow(t, z + 0.5) * Math.exp(-t) * x;
}

function gammainc(a, x) {
  if (x === 0) return 0;
  const EPS = 1e-12, MAX = 200;
  if (x < a + 1) {
    let sum = 1/a, term = 1/a;
    for (let n = 1; n < MAX; n++) { term *= x / (a + n); sum += term; if (Math.abs(term) < EPS * Math.abs(sum)) break; }
    return sum * Math.exp(-x + a * Math.log(x) - Math.log(gammafn(a)));
  } else {
    let b = x + 1 - a, c = 1e30, d = 1 / b, h = d;
    for (let i = 1; i < MAX; i++) {
      const an = -i * (i - a); b += 2; d = an * d + b; if (Math.abs(d) < 1e-30) d = 1e-30;
      c = b + an / c; if (Math.abs(c) < 1e-30) c = 1e-30;
      d = 1 / d; const del = d * c; h *= del; if (Math.abs(del - 1) < EPS) break;
    }
    return 1 - Math.exp(-x + a * Math.log(x) - Math.log(gammafn(a))) * h;
  }
}

function gedPdf(x, mu, alpha, beta) {
  const z = Math.abs((x - mu) / alpha);
  return (beta / (2 * alpha * gammafn(1 / beta))) * Math.exp(-Math.pow(z, beta));
}

function gedCdf(x, mu, alpha, beta) {
  const z = (x - mu) / alpha;
  if (z === 0) return 0.5;
  const absZ = Math.abs(z);
  const inc = gammainc(1 / beta, Math.pow(absZ, beta));
  return z < 0 ? 0.5 * (1 - inc) : 0.5 * (1 + inc);
}

function gedQuantile(p, mu, alpha, beta) {
  if (p <= 0) return -Infinity; if (p >= 1) return Infinity;
  let lo = mu - 10 * alpha, hi = mu + 10 * alpha;
  for (let i = 0; i < 100; i++) {
    const mid = (lo + hi) / 2, cdf = gedCdf(mid, mu, alpha, beta);
    if (Math.abs(cdf - p) < 1e-10) return mid;
    if (cdf < p) lo = mid; else hi = mid;
  }
  return (lo + hi) / 2;
}

function draw() {
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width * dpr;
  canvas.height = rect.height * dpr;
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);
  const w = rect.width, h = rect.height;
  ctx.clearRect(0, 0, w, h);

  const L = 40, R = 20, T = 20, B = 30;
  const graphW = w - L - R, graphH = h - T - B;

  const spread = alpha * 4;
  const xMin = mu - spread, xMax = mu + spread;
  const steps = 300;
  let maxPdf = 0;
  for (let i = 0; i <= steps; i++) { const x = xMin + (i / steps) * (xMax - xMin); maxPdf = Math.max(maxPdf, gedPdf(x, mu, alpha, beta)); }
  const yMax = maxPdf * 1.15;

  ctx.strokeStyle = '#ddd';
  ctx.beginPath(); ctx.moveTo(L, h - B); ctx.lineTo(w - R, h - B); ctx.moveTo(L, T); ctx.lineTo(L, h - B); ctx.stroke();

  ctx.beginPath(); ctx.moveTo(L, h - B);
  for (let i = 0; i <= steps; i++) {
    const x = xMin + (i / steps) * (xMax - xMin);
    const px = L + (i / steps) * graphW;
    const pdf = gedPdf(x, mu, alpha, beta);
    const py = h - B - (Math.min(pdf, yMax) / yMax) * graphH;
    ctx.lineTo(px, py);
  }
  ctx.lineTo(L + graphW, h - B); ctx.closePath();
  ctx.fillStyle = 'rgba(139,92,246,0.2)'; ctx.fill();
  ctx.strokeStyle = '#8b5cf6'; ctx.lineWidth = 2; ctx.stroke();

  ctx.fillStyle = '#666'; ctx.font = '11px sans-serif'; ctx.textAlign = 'center';
  for (let i = 0; i <= 5; i++) { const xVal = xMin + (i / 5) * (xMax - xMin); ctx.fillText(xVal.toFixed(1), L + i / 5 * graphW, h - 10); }
}

function updateTable() {
  const tbody = document.getElementById('pdfTableBody');
  const probs = [0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.99];
  let html = '', maxPdf = 0;
  const xVals = probs.map(p => gedQuantile(p, mu, alpha, beta));
  xVals.forEach(x => { const pdf = gedPdf(x, mu, alpha, beta); if (pdf > maxPdf) maxPdf = pdf; });

  probs.forEach((p, i) => {
    const x = xVals[i], pdf = gedPdf(x, mu, alpha, beta);
    const barW = maxPdf > 0 ? (pdf / maxPdf) * 100 : 0;
    html += `<tr>
      <td style="text-align:center; font-weight:600; color:#333">${x.toFixed(3)}</td>
      <td><div style="font-family:monospace; color:var(--accent)">${pdf.toFixed(4)}</div>
        <div class="prob-bar-bg"><div class="prob-bar-fill" style="width:${barW}%"></div></div></td>
      <td style="font-family:monospace; color:#555">${p.toFixed(2)}</td>
    </tr>`;
  });
  tbody.innerHTML = html;
}

function sync(newMu, newAlpha, newBeta) {
  mu = parseFloat(newMu) || 0; alpha = parseFloat(newAlpha) || 1; beta = parseFloat(newBeta) || 2;
  mu = Math.max(-5, Math.min(5, mu));
  alpha = Math.max(0.1, Math.min(5, alpha));
  beta = Math.max(0.3, Math.min(10, beta));

  document.getElementById('mu').value = Math.max(-3, Math.min(3, mu));
  document.getElementById('muNum').value = mu.toFixed(2);
  document.getElementById('alpha').value = Math.max(0.3, Math.min(3, alpha));
  document.getElementById('alphaNum').value = alpha.toFixed(2);
  document.getElementById('beta').value = Math.max(0.5, Math.min(5, beta));
  document.getElementById('betaNum').value = beta.toFixed(2);

  const variance = alpha * alpha * gammafn(3 / beta) / gammafn(1 / beta);
  document.getElementById('muOut').textContent = mu.toFixed(2);
  document.getElementById('alphaOut').textContent = alpha.toFixed(2);
  document.getElementById('betaOut').textContent = beta.toFixed(2);
  document.getElementById('meanOut').textContent = mu.toFixed(2);
  document.getElementById('varOut').textContent = variance.toFixed(3);

  draw(); updateTable(); calcD(); calcP(); calcQ();
}

function calcD() { const x = parseFloat(document.getElementById('d_x').value) || 0; document.getElementById('d_res').textContent = gedPdf(x, mu, alpha, beta).toFixed(6); }
function calcP() { const x = parseFloat(document.getElementById('p_x').value) || 0; document.getElementById('p_res').textContent = gedCdf(x, mu, alpha, beta).toFixed(6); }
function calcQ() { const p = parseFloat(document.getElementById('q_p').value) || 0.5; const r = gedQuantile(p, mu, alpha, beta); document.getElementById('q_res').textContent = Number.isFinite(r) ? r.toFixed(6) : 'Infinity'; }

document.getElementById('mu').addEventListener('input', e => sync(e.target.value, alpha, beta));
document.getElementById('muNum').addEventListener('input', e => sync(e.target.value, alpha, beta));
document.getElementById('alpha').addEventListener('input', e => sync(mu, e.target.value, beta));
document.getElementById('alphaNum').addEventListener('input', e => sync(mu, e.target.value, beta));
document.getElementById('beta').addEventListener('input', e => sync(mu, alpha, e.target.value));
document.getElementById('betaNum').addEventListener('input', e => sync(mu, alpha, e.target.value));
document.getElementById('d_x').addEventListener('input', calcD);
document.getElementById('p_x').addEventListener('input', calcP);
document.getElementById('q_p').addEventListener('input', calcQ);
window.addEventListener('resize', draw);
sync(0, 1, 2);
</script>
</body>
</html>
