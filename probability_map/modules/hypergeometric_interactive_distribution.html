<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Hypergeometric â€“ Interactive Distribution</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}]});"></script>
  <style>
    :root{ --bg:#f5f7f9; --panel:#ffffff; --ink:#111; --muted:#555; --border:#dcdcdc; --accent:#2563eb; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial; color:var(--ink); background:var(--bg)}
    header{padding:12px 20px; background:#2563eb; color:#fff; font-weight:600; font-size:18px}

    .wrap{max-width:1200px; margin:14px auto; padding:0 14px; display:grid; grid-template-columns: 320px 1fr; grid-template-rows: auto auto; gap:14px}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:14px}

    .row{display:flex; align-items:center; gap:8px; margin:8px 0; flex-wrap:wrap}
    label{min-width:24px; color:#333; font-weight:600}
    input[type="range"]{width:100px}
    input[type="number"]{width:64px; padding:5px 6px; border:1px solid var(--border); border-radius:6px; font-size:13px}
    .note{color:var(--muted); font-size:12px}

    .kblock{background:#fafafa; border:1px solid var(--border); border-radius:10px; padding:12px; margin-top:12px}
    .kblock-title{font-weight:600; font-size:13px; color:var(--accent); margin-bottom:8px}

    .plot-card{grid-column:2; grid-row:1}
    .plot{background:#fff; border:1px solid var(--border); border-radius:12px; padding:12px}
    .plot h3{margin:0 0 8px 0; font-size:14px; font-weight:600}
    canvas{width:100%; height:300px; display:block; background:#fafafa; border-radius:8px}

    .axis-controls{display:flex; gap:16px; margin-top:10px; justify-content:center; flex-wrap:wrap}
    .axis-btn-group{display:flex; align-items:center; gap:6px; font-size:12px; color:var(--muted)}
    .axis-btn{padding:3px 8px; border:1px solid var(--border); background:#fff; border-radius:4px; font-size:11px; cursor:pointer; transition:all 0.2s}
    .axis-btn.active{background:var(--accent); color:#fff; border-color:var(--accent)}
    .axis-btn:hover:not(.active){background:#dbeafe}

    .stats-bar{display:flex; justify-content:center; gap:20px; padding:10px; background:#dbeafe; border-radius:8px; margin-top:12px; font-size:13px; flex-wrap:wrap}
    .stat-item{text-align:center}
    .stat-label{color:var(--muted); font-size:11px}
    .stat-value{font-weight:600; color:var(--accent)}

    .calc-card{grid-column:2; grid-row:2; margin-top:0}
    .calc-grid{display:grid; grid-template-columns: repeat(3, 1fr); gap:12px}
    @media (max-width: 1100px) { .calc-grid{grid-template-columns: 1fr} }

    .calc-box{background:#fafafa; border:1px solid var(--border); border-radius:10px; padding:12px}
    .calc-box h4{font-size:13px; color:var(--accent); margin:0 0 10px 0; display:flex; align-items:center; gap:6px}
    .calc-box h4 code{background:#dbeafe; padding:2px 6px; border-radius:4px; font-size:12px}
    .calc-row{display:flex; align-items:center; gap:8px; margin:8px 0}
    .calc-row label{font-size:13px; color:var(--muted); min-width:60px}
    .calc-row input{flex:1; padding:6px 8px; border:1px solid var(--border); border-radius:6px; font-size:13px}
    .calc-row .result{flex:1; padding:6px 8px; background:#fff; border:1px solid var(--accent); border-radius:6px; font-weight:600; color:var(--accent); font-size:13px; min-height:34px; display:flex; align-items:center}
    .calc-btn{width:100%; padding:6px; background:var(--accent); color:#fff; border:none; border-radius:6px; font-weight:600; cursor:pointer; margin-top:6px; transition:background 0.2s; font-size:13px}
    .calc-btn:hover{background:#1d4ed8}
    .calc-note{font-size:11px; color:var(--muted); margin-top:6px; line-height:1.3}

    .examples-card{grid-column:1; grid-row:2}
    .examples-card h4{font-size:13px; color:var(--accent); margin:0 0 10px 0}
    .example-item{padding:10px; border-radius:8px; margin-bottom:8px; cursor:pointer; border:1px solid var(--border); transition:all 0.2s}
    .example-item:hover{background:#dbeafe; border-color:var(--accent)}
    .example-item.active{background:#dbeafe; border-color:var(--accent)}
    .example-item .ex-title{font-weight:600; font-size:13px; margin-bottom:2px}
    .example-item .ex-params{color:var(--accent); font-family:monospace; font-size:12px}
    .example-item .ex-desc{color:var(--muted); font-size:11px; margin-top:4px}

    @media (max-width: 900px){ 
      .wrap{grid-template-columns: 1fr} 
      .plot-card{grid-column:1; grid-row:2}
      .examples-card{grid-column:1; grid-row:3}
      .calc-card{grid-column:1; grid-row:4}
      .calc-grid{grid-template-columns: 1fr}
    }
  </style>
</head>
<body>
<header>Hypergeometric Distribution $X \sim \text{Hypergeom}(N, K, n)$</header>

<main class="wrap">
  <section class="card">
    <div class="row">
      <label>$N$</label>
      <input id="N" type="range" min="10" max="80" step="1" value="50">
      <input id="NNum" type="number" min="1" max="200" step="1" value="50">
      <span class="note">(population)</span>
    </div>
    <div class="row">
      <label>$K$</label>
      <input id="K" type="range" min="0" max="80" step="1" value="20">
      <input id="KNum" type="number" min="0" max="200" step="1" value="20">
      <span class="note">(# successes in pop)</span>
    </div>
    <div class="row">
      <label>$n$</label>
      <input id="n" type="range" min="1" max="40" step="1" value="10">
      <input id="nNum" type="number" min="1" max="200" step="1" value="10">
      <span class="note">(sample size)</span>
    </div>

    <div class="kblock">
      <div class="kblock-title">Probability Mass Function</div>
      <div style="text-align:center; font-size:14px">
        $$P(X=k) = \frac{\binom{K}{k}\binom{N-K}{n-k}}{\binom{N}{n}}$$
      </div>
    </div>

    <div class="kblock">
      <div class="kblock-title">Key Properties</div>
      <table style="width:100%; font-size:12px">
        <tr><td style="color:var(--muted)">Support</td><td>$\max(0, n-(N-K)) \leq k \leq \min(n, K)$</td></tr>
        <tr><td style="color:var(--muted)">Mean</td><td>$E[X] = n\frac{K}{N}$</td></tr>
        <tr><td style="color:var(--muted)">Variance</td><td>$n\frac{K}{N}\frac{N-K}{N}\frac{N-n}{N-1}$</td></tr>
      </table>
    </div>
  </section>

  <section class="card plot-card">
    <div class="plot">
      <h3>PMF $P(X=k)$</h3>
      <canvas id="pmf"></canvas>
      <div class="axis-controls">
        <div class="axis-btn-group">
          <span>y-axis:</span>
          <button class="axis-btn active" id="yAuto">Auto</button>
          <button class="axis-btn" id="yFixed">Fixed</button>
        </div>
      </div>
      <div class="stats-bar">
        <div class="stat-item"><div class="stat-label">$N$</div><div class="stat-value" id="NOut">50</div></div>
        <div class="stat-item"><div class="stat-label">$K$</div><div class="stat-value" id="KOut">20</div></div>
        <div class="stat-item"><div class="stat-label">$n$</div><div class="stat-value" id="nOut">10</div></div>
        <div class="stat-item"><div class="stat-label">$E[X]$</div><div class="stat-value" id="meanOut">4.00</div></div>
        <div class="stat-item"><div class="stat-label">$\text{Var}[X]$</div><div class="stat-value" id="varOut">1.96</div></div>
      </div>
    </div>
  </section>

  <section class="card examples-card">
    <h4>ðŸ“š Examples</h4>
    <div class="example-item active" data-N="50" data-K="20" data-n="10">
      <div class="ex-title">Quality Control</div>
      <div class="ex-params">N=50, K=20, n=10</div>
      <div class="ex-desc">10 items from 50 (20 defective).</div>
    </div>
    <div class="example-item" data-N="52" data-K="13" data-n="5">
      <div class="ex-title">Card Draw (Hearts)</div>
      <div class="ex-params">N=52, K=13, n=5</div>
      <div class="ex-desc"># hearts in 5-card hand.</div>
    </div>
    <div class="example-item" data-N="20" data-K="6" data-n="5">
      <div class="ex-title">Committee Selection</div>
      <div class="ex-params">N=20, K=6, n=5</div>
      <div class="ex-desc"># women in 5-person committee from 20 (6 women).</div>
    </div>
    <div class="example-item" data-N="100" data-K="30" data-n="15">
      <div class="ex-title">Capture-Recapture</div>
      <div class="ex-params">N=100, K=30, n=15</div>
      <div class="ex-desc"># tagged fish in sample.</div>
    </div>
  </section>

  <section class="card calc-card">
    <h3 style="margin:0 0 14px 0; font-size:15px; color:var(--accent)">ðŸ“Š Probability Calculator</h3>
    <div class="calc-grid">
      <div class="calc-box">
        <h4><code>dhyper(k)</code> PMF</h4>
        <div class="calc-row">
          <label>k =</label>
          <input type="number" id="dhyper_k" value="4" min="0" step="1">
        </div>
        <button class="calc-btn" onclick="calcDhyper()">Calculate P(X=k)</button>
        <div class="calc-row">
          <label>P(X=k) =</label>
          <div class="result" id="dhyper_result">0.226413</div>
        </div>
        <div class="calc-note">R: <code>dhyper(k, K, N-K, n)</code></div>
      </div>

      <div class="calc-box">
        <h4><code>phyper(k)</code> CDF</h4>
        <div class="calc-row">
          <label>k =</label>
          <input type="number" id="phyper_k" value="4" min="0" step="1">
        </div>
        <button class="calc-btn" onclick="calcPhyper()">Calculate P(Xâ‰¤k)</button>
        <div class="calc-row">
          <label>P(Xâ‰¤k) =</label>
          <div class="result" id="phyper_result">0.606693</div>
        </div>
        <div class="calc-note">R: <code>phyper(k, K, N-K, n)</code></div>
      </div>

      <div class="calc-box">
        <h4><code>qhyper(q)</code> Quantile</h4>
        <div class="calc-row">
          <label>q =</label>
          <input type="number" id="qhyper_q" value="0.5" min="0" max="1" step="0.01">
        </div>
        <button class="calc-btn" onclick="calcQhyper()">Calculate k</button>
        <div class="calc-row">
          <label>k =</label>
          <div class="result" id="qhyper_result">4</div>
        </div>
        <div class="calc-note">Smallest k where P(Xâ‰¤k) â‰¥ q</div>
      </div>
    </div>
  </section>
</main>

<script>
const NSlider = document.getElementById('N');
const NNum = document.getElementById('NNum');
const KSlider = document.getElementById('K');
const KNum = document.getElementById('KNum');
const nSlider = document.getElementById('n');
const nNum = document.getElementById('nNum');
const pmfCanvas = document.getElementById('pmf');

let N = 50, K = 20, n = 10;
let yAxisMode = 'auto';
const fixedYMax = 0.4;

function setupCanvas(canvas) {
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = Math.round(rect.width * dpr);
  canvas.height = Math.round(rect.height * dpr);
  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  return ctx;
}

function comb(n, k) {
  if (k < 0 || k > n) return 0;
  k = Math.min(k, n - k);
  let res = 1;
  for (let i = 1; i <= k; i++) res *= (n - k + i) / i;
  return res;
}

function hyperPmf(k, N, K, n) {
  const denom = comb(N, n);
  if (denom === 0) return 0;
  return comb(K, k) * comb(N - K, n - k) / denom;
}

function hyperCdf(k, N, K, n) {
  const kMin = Math.max(0, n - (N - K));
  let sum = 0;
  for (let i = kMin; i <= k; i++) sum += hyperPmf(i, N, K, n);
  return Math.min(1, sum);
}

function hyperQuantile(q, N, K, n) {
  const kMin = Math.max(0, n - (N - K));
  const kMax = Math.min(n, K);
  let cumProb = 0;
  for (let k = kMin; k <= kMax; k++) {
    cumProb += hyperPmf(k, N, K, n);
    if (cumProb >= q) return k;
  }
  return kMax;
}

function draw() {
  const ctx = setupCanvas(pmfCanvas);
  const rect = pmfCanvas.getBoundingClientRect();
  const w = rect.width, h = rect.height;
  ctx.clearRect(0, 0, w, h);

  const L = 50, R = 15, T = 15, B = 35;
  const plotW = w - L - R, plotH = h - T - B, yBase = h - B;

  const kMin = Math.max(0, n - (N - K));
  const kMax = Math.min(n, K);
  const m = kMax - kMin + 1;
  if (m <= 0) return;

  const probs = [];
  let maxP = 0;
  for (let k = kMin; k <= kMax; k++) {
    const p = hyperPmf(k, N, K, n);
    probs.push(p);
    if (p > maxP) maxP = p;
  }

  let ymax = yAxisMode === 'fixed' ? fixedYMax : maxP * 1.15;

  // Grid
  ctx.strokeStyle = '#f0f0f0';
  ctx.lineWidth = 1;
  for (let i = 1; i < 5; i++) {
    const y = yBase - (i / 5) * plotH;
    ctx.beginPath(); ctx.moveTo(L, y); ctx.lineTo(w - R, y); ctx.stroke();
  }

  // Axes
  ctx.strokeStyle = '#ddd';
  ctx.lineWidth = 1.5;
  ctx.beginPath(); ctx.moveTo(L, yBase); ctx.lineTo(w - R, yBase); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(L, T); ctx.lineTo(L, yBase); ctx.stroke();

  // Y labels
  ctx.font = '11px system-ui';
  ctx.fillStyle = '#888';
  ctx.textAlign = 'right';
  for (let i = 0; i <= 4; i++) {
    const yVal = (i / 4) * ymax;
    const y = yBase - (i / 4) * plotH;
    ctx.fillText(yVal.toFixed(2), L - 8, y + 4);
  }

  // Bars
  const barW = Math.min(26, plotW / (m * 1.4));
  for (let i = 0; i < m; i++) {
    const k = kMin + i;
    const pval = probs[i];
    const xCenter = L + (i + 0.5) * plotW / m;
    const barHeight = Math.min(pval, ymax) / ymax * plotH;
    const x = xCenter - barW / 2;
    const y = yBase - barHeight;

    ctx.fillStyle = '#2563eb';
    ctx.fillRect(x, y, barW, barHeight);

    // X label
    ctx.fillStyle = '#777';
    ctx.font = '11px system-ui';
    ctx.textAlign = 'center';
    if (m <= 15 || i % 2 === 0) ctx.fillText(String(k), xCenter, h - 12);
  }

  // Mean line
  const mean = n * K / N;
  const xMean = L + (mean - kMin + 0.5) * plotW / m;
  if (xMean >= L && xMean <= w - R) {
    ctx.beginPath();
    ctx.moveTo(xMean, yBase);
    ctx.lineTo(xMean, T);
    ctx.strokeStyle = '#666';
    ctx.lineWidth = 1.5;
    ctx.setLineDash([4, 4]);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = '#666';
    ctx.textAlign = 'center';
    ctx.fillText('Î¼', xMean, T - 5);
  }
}

function sync(newN, newK, newn) {
  N = parseInt(newN) || 50;
  K = parseInt(newK) || 20;
  n = parseInt(newn) || 10;

  N = Math.max(1, Math.min(200, N));
  K = Math.max(0, Math.min(N, K));
  n = Math.max(1, Math.min(N, n));

  NSlider.value = Math.min(80, N);
  NNum.value = N;
  KSlider.value = Math.min(80, K);
  KNum.value = K;
  nSlider.value = Math.min(40, n);
  nNum.value = n;

  const p = N > 0 ? K / N : 0;
  const mean = n * p;
  const variance = N > 1 ? n * p * (1 - p) * ((N - n) / (N - 1)) : 0;

  document.getElementById('NOut').textContent = N;
  document.getElementById('KOut').textContent = K;
  document.getElementById('nOut').textContent = n;
  document.getElementById('meanOut').textContent = mean.toFixed(2);
  document.getElementById('varOut').textContent = variance.toFixed(2);

  draw();
  calcDhyper();
  calcPhyper();
  calcQhyper();
}

function calcDhyper() {
  const k = parseInt(document.getElementById('dhyper_k').value) || 0;
  const result = hyperPmf(k, N, K, n);
  document.getElementById('dhyper_result').textContent = result.toFixed(6);
}

function calcPhyper() {
  const k = parseInt(document.getElementById('phyper_k').value) || 0;
  const result = hyperCdf(k, N, K, n);
  document.getElementById('phyper_result').textContent = result.toFixed(6);
}

function calcQhyper() {
  const q = parseFloat(document.getElementById('qhyper_q').value) || 0.5;
  const result = hyperQuantile(q, N, K, n);
  document.getElementById('qhyper_result').textContent = result;
}

// Event listeners
NSlider.addEventListener('input', e => sync(e.target.value, K, n));
NNum.addEventListener('input', e => sync(e.target.value, K, n));
KSlider.addEventListener('input', e => sync(N, e.target.value, n));
KNum.addEventListener('input', e => sync(N, e.target.value, n));
nSlider.addEventListener('input', e => sync(N, K, e.target.value));
nNum.addEventListener('input', e => sync(N, K, e.target.value));

document.getElementById('yAuto').addEventListener('click', () => {
  yAxisMode = 'auto';
  document.getElementById('yAuto').classList.add('active');
  document.getElementById('yFixed').classList.remove('active');
  draw();
});
document.getElementById('yFixed').addEventListener('click', () => {
  yAxisMode = 'fixed';
  document.getElementById('yFixed').classList.add('active');
  document.getElementById('yAuto').classList.remove('active');
  draw();
});

// Examples
document.querySelectorAll('.example-item').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.example-item').forEach(el => el.classList.remove('active'));
    item.classList.add('active');
    sync(item.dataset.N, item.dataset.K, item.dataset.n);
  });
});

document.getElementById('dhyper_k').addEventListener('input', calcDhyper);
document.getElementById('phyper_k').addEventListener('input', calcPhyper);
document.getElementById('qhyper_q').addEventListener('input', calcQhyper);

window.addEventListener('resize', draw);

// Init
sync(50, 20, 10);
</script>
</body>
</html>
