<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Normal ‚Äì Interactive Distribution</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}]});"></script>
  <style>
    :root{ --bg:#f5f7f9; --panel:#ffffff; --ink:#111; --muted:#555; --border:#dcdcdc; --accent:#ef4444; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial; color:var(--ink); background:var(--bg)}
    header{padding:12px 20px; background:#ef4444; color:#fff; font-weight:600; font-size:18px}

    /* Ê†∏ÂøÉÂ∏ÉÂ±Ä Grid ÂÆö‰πâ */
    .wrap{max-width:1200px; margin:14px auto; padding:0 14px; display:grid; grid-template-columns: 320px 1fr; grid-template-rows: auto auto; gap:14px}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:14px}

    /* Parameter controls */
    .row{display:flex; align-items:center; gap:10px; margin:8px 0; flex-wrap:wrap}
    label{min-width:24px; color:#333; font-weight:600}
    input[type="range"]{width:120px}
    input[type="number"]{width:72px; padding:6px 8px; border:1px solid var(--border); border-radius:6px}
    .note{color:var(--muted); font-size:13px}

    .kblock{background:#fafafa; border:1px solid var(--border); border-radius:10px; padding:12px; margin-top:12px}
    .kblock-title{font-weight:600; font-size:13px; color:var(--accent); margin-bottom:8px}

    /* Plot area - ‰øÆÊîπ‰∏∫Âè™Âç†Á¨¨1Ë°å */
    .plot-card{grid-column:2; grid-row:1} 

    .plot{background:#fff; border:1px solid var(--border); border-radius:12px; padding:12px}
    .plot h3{margin:0 0 8px 0; font-size:14px; font-weight:600}
    canvas{width:100%; height:300px; display:block; background:#fafafa; border-radius:8px}

    /* Axis controls */
    .axis-controls{display:flex; gap:16px; margin-top:10px; justify-content:center; flex-wrap:wrap}
    .axis-btn-group{display:flex; align-items:center; gap:6px; font-size:12px; color:var(--muted)}
    .axis-btn{padding:3px 8px; border:1px solid var(--border); background:#fff; border-radius:4px; font-size:11px; cursor:pointer; transition:all 0.2s}
    .axis-btn.active{background:var(--accent); color:#fff; border-color:var(--accent)}
    .axis-btn:hover:not(.active){background:#fef2f2}

    /* Stats bar */
    .stats-bar{display:flex; justify-content:center; gap:24px; padding:10px; background:#fef2f2; border-radius:8px; margin-top:12px; font-size:13px}
    .stat-item{text-align:center}
    .stat-label{color:var(--muted); font-size:11px}
    .stat-value{font-weight:600; color:var(--accent)}

    /* Calculator section - ‰øÆÊîπ‰∏∫Á¨¨2ÂàóÔºåÁ¨¨2Ë°å */
    .calc-card{grid-column:2; grid-row:2; margin-top:0} 

    .calc-grid{display:grid; grid-template-columns: repeat(3, 1fr); gap:12px}

    /* ‰∏∫‰∫ÜÈÄÇÂ∫îÂè≥‰æßÂ∏ÉÂ±ÄÔºåÂΩìÂ±èÂπïËæÉÁ™ÑÊó∂ËÆ°ÁÆóÂô®ÂÜÖÈÉ®Ëá™Âä®Êç¢Ë°å */
    @media (max-width: 1100px) { .calc-grid{grid-template-columns: 1fr} }

    .calc-box{background:#fafafa; border:1px solid var(--border); border-radius:10px; padding:12px}
    .calc-box h4{font-size:13px; color:var(--accent); margin:0 0 10px 0; display:flex; align-items:center; gap:6px}
    .calc-box h4 code{background:#fee2e2; padding:2px 6px; border-radius:4px; font-size:12px}
    .calc-row{display:flex; align-items:center; gap:8px; margin:8px 0}
    .calc-row label{font-size:13px; color:var(--muted); min-width:60px}
    .calc-row input{flex:1; padding:6px 8px; border:1px solid var(--border); border-radius:6px; font-size:13px}
    .calc-row .result{flex:1; padding:6px 8px; background:#fff; border:1px solid var(--accent); border-radius:6px; font-weight:600; color:var(--accent); font-size:13px; min-height:34px; display:flex; align-items:center}
    .calc-btn{width:100%; padding:6px; background:var(--accent); color:#fff; border:none; border-radius:6px; font-weight:600; cursor:pointer; margin-top:6px; transition:background 0.2s; font-size:13px}
    .calc-btn:hover{background:#dc2626}
    .calc-note{font-size:11px; color:var(--muted); margin-top:6px; line-height:1.3}

    /* Examples - ‰øùÊåÅÂú®Á¨¨1ÂàóÔºå‰ΩÜÊòéÁ°ÆÊåáÂÆöÂú®Á¨¨2Ë°å */
    .examples-card{grid-column:1; grid-row:2} 
    .examples-card h4{font-size:13px; color:var(--accent); margin:0 0 10px 0}
    .example-item{padding:10px; border-radius:8px; margin-bottom:8px; cursor:pointer; border:1px solid var(--border); transition:all 0.2s}
    .example-item:hover{background:#fef2f2; border-color:var(--accent)}
    .example-item.active{background:#fef2f2; border-color:var(--accent)}
    .example-item .ex-title{font-weight:600; font-size:13px; margin-bottom:2px}
    .example-item .ex-params{color:var(--accent); font-family:monospace; font-size:12px}
    .example-item .ex-desc{color:var(--muted); font-size:11px; margin-top:4px}

    /* ÁßªÂä®Á´ØÂìçÂ∫îÂºèË∞ÉÊï¥ */
    @media (max-width: 900px){ 
      .wrap{grid-template-columns: 1fr} 
      .plot-card{grid-column:1; grid-row:2}
      .examples-card{grid-column:1; grid-row:3}
      .calc-card{grid-column:1; grid-row:4} /* ÁßªÂä®Á´ØÊéíÂà∞ÊúÄÂêé */
      .calc-grid{grid-template-columns: 1fr}
    }
  </style>
</head>
<body>
<header>Normal Distribution $X \sim \mathcal{N}(\mu, \sigma^2)$</header>

<main class="wrap">
  <section class="card">
    <div class="row">
      <label>$\mu$</label>
      <input id="mu" type="range" min="-4" max="4" step="0.1" value="0">
      <input id="muNum" type="number" min="-10" max="10" step="0.1" value="0">
      <span class="note">(mean)</span>
    </div>
    <div class="row">
      <label>$\sigma$</label>
      <input id="sigma" type="range" min="0.3" max="3" step="0.1" value="1">
      <input id="sigmaNum" type="number" min="0.1" max="10" step="0.1" value="1">
      <span class="note">(std dev)</span>
    </div>

    <div class="kblock">
      <div class="kblock-title">Probability Density Function</div>
      <div style="text-align:center; font-size:14px">
        $$f(x) = \frac{1}{\sigma\sqrt{2\pi}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}$$
      </div>
    </div>

    <div class="kblock">
      <div class="kblock-title">Key Properties</div>
      <table style="width:100%; font-size:12px">
        <tr><td style="color:var(--muted)">Support</td><td>$x \in (-\infty, +\infty)$</td></tr>
        <tr><td style="color:var(--muted)">Mean</td><td>$E[X] = \mu$</td></tr>
        <tr><td style="color:var(--muted)">Variance</td><td>$\text{Var}[X] = \sigma^2$</td></tr>
        <tr><td style="color:var(--muted)">Skewness</td><td>$0$</td></tr>
        <tr><td style="color:var(--muted)">Kurtosis</td><td>$3$</td></tr>
      </table>
    </div>
  </section>

  <section class="card plot-card">
    <div class="plot">
      <h3>PDF $f(x)$</h3>
      <canvas id="pdf"></canvas>
      <div class="axis-controls">
        <div class="axis-btn-group">
          <span>x-axis:</span>
          <button class="axis-btn active" id="xAuto">Auto</button>
          <button class="axis-btn" id="xFixed">Fixed</button>
        </div>
        <div class="axis-btn-group">
          <span>y-axis:</span>
          <button class="axis-btn active" id="yAuto">Auto</button>
          <button class="axis-btn" id="yFixed">Fixed</button>
        </div>
      </div>
      <div class="stats-bar">
        <div class="stat-item"><div class="stat-label">$\mu$</div><div class="stat-value" id="muOut">0.0</div></div>
        <div class="stat-item"><div class="stat-label">$\sigma$</div><div class="stat-value" id="sigmaOut">1.0</div></div>
        <div class="stat-item"><div class="stat-label">$\sigma^2$</div><div class="stat-value" id="varOut">1.00</div></div>
        <div class="stat-item"><div class="stat-label">68% range</div><div class="stat-value" id="range68">[-1, 1]</div></div>
        <div class="stat-item"><div class="stat-label">95% range</div><div class="stat-value" id="range95">[-2, 2]</div></div>
      </div>
    </div>
  </section>

  <section class="card examples-card">
    <h4>üìö Examples</h4>
    <div class="example-item active" data-mu="0" data-sigma="1">
      <div class="ex-title">Standard Normal</div>
      <div class="ex-params">Œº=0, œÉ=1</div>
      <div class="ex-desc">The reference distribution, Z-scores.</div>
    </div>
    <div class="example-item" data-mu="100" data-sigma="15">
      <div class="ex-title">IQ Scores</div>
      <div class="ex-params">Œº=100, œÉ=15</div>
      <div class="ex-desc">Intelligence quotient distribution.</div>
    </div>
    <div class="example-item" data-mu="70" data-sigma="3">
      <div class="ex-title">Human Height (inches)</div>
      <div class="ex-params">Œº=70, œÉ=3</div>
      <div class="ex-desc">Adult male height in the US.</div>
    </div>
    <div class="example-item" data-mu="0" data-sigma="0.5">
      <div class="ex-title">Narrow Distribution</div>
      <div class="ex-params">Œº=0, œÉ=0.5</div>
      <div class="ex-desc">Low variance, concentrated around mean.</div>
    </div>
  </section>

  <section class="card calc-card">
    <h3 style="margin:0 0 14px 0; font-size:15px; color:var(--accent)">üìä Probability Calculator</h3>
    <div class="calc-grid">
      <div class="calc-box">
        <h4><code>dnorm(x)</code> Density</h4>
        <div class="calc-row">
          <label>x =</label>
          <input type="number" id="dnorm_x" value="0" step="0.1">
        </div>
        <button class="calc-btn" onclick="calcDnorm()">Calculate f(x)</button>
        <div class="calc-row">
          <label>f(x) =</label>
          <div class="result" id="dnorm_result">0.3989</div>
        </div>
        <div class="calc-note">Height of PDF. R: <code>dnorm(x, Œº, œÉ)</code></div>
      </div>

      <div class="calc-box">
        <h4><code>pnorm(x)</code> CDF</h4>
        <div class="calc-row">
          <label>x =</label>
          <input type="number" id="pnorm_x" value="0" step="0.1">
        </div>
        <button class="calc-btn" onclick="calcPnorm()">Calculate P(X ‚â§ x)</button>
        <div class="calc-row">
          <label>Prob =</label>
          <div class="result" id="pnorm_result">0.5000</div>
        </div>
        <div class="calc-note">Area to left. R: <code>pnorm(x, Œº, œÉ)</code></div>
      </div>

      <div class="calc-box">
        <h4><code>qnorm(p)</code> Quantile</h4>
        <div class="calc-row">
          <label>p =</label>
          <input type="number" id="qnorm_p" value="0.5" step="0.01" min="0.001" max="0.999">
        </div>
        <button class="calc-btn" onclick="calcQnorm()">Calculate x</button>
        <div class="calc-row">
          <label>x =</label>
          <div class="result" id="qnorm_result">0.0000</div>
        </div>
        <div class="calc-note">Inverse CDF. R: <code>qnorm(p, Œº, œÉ)</code></div>
      </div>
    </div>
  </section>
</main>

<script>
// State
let mu = 0, sigma = 1;
let xAxisMode = 'auto', yAxisMode = 'auto';
const fixedXMin = -6, fixedXMax = 6, fixedYMax = 0.5;

// DOM
const muSlider = document.getElementById('mu');
const muNum = document.getElementById('muNum');
const sigmaSlider = document.getElementById('sigma');
const sigmaNum = document.getElementById('sigmaNum');
const pdfCanvas = document.getElementById('pdf');

// Normal PDF
function normalPdf(x, m, s) {
  const z = (x - m) / s;
  return Math.exp(-0.5 * z * z) / (s * Math.sqrt(2 * Math.PI));
}

// Normal CDF using error function approximation
function normalCdf(x, m, s) {
  const z = (x - m) / s;
  return 0.5 * (1 + erf(z / Math.sqrt(2)));
}

// Error function approximation
function erf(x) {
  const a1 =  0.254829592, a2 = -0.284496736, a3 =  1.421413741;
  const a4 = -1.453152027, a5 =  1.061405429, p  =  0.3275911;
  const sign = x < 0 ? -1 : 1;
  x = Math.abs(x);
  const t = 1.0 / (1.0 + p * x);
  const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
  return sign * y;
}

// Inverse normal CDF (quantile function) - Newton-Raphson
function normalQuantile(p, m, s) {
  if (p <= 0) return -Infinity;
  if (p >= 1) return Infinity;

  // Initial guess using rational approximation
  let x;
  if (p < 0.5) {
    const t = Math.sqrt(-2 * Math.log(p));
    x = -(2.515517 + 0.802853*t + 0.010328*t*t) / (1 + 1.432788*t + 0.189269*t*t + 0.001308*t*t*t) + t;
  } else {
    const t = Math.sqrt(-2 * Math.log(1 - p));
    x = (2.515517 + 0.802853*t + 0.010328*t*t) / (1 + 1.432788*t + 0.189269*t*t + 0.001308*t*t*t) - t;
  }

  // Newton-Raphson refinement
  for (let i = 0; i < 5; i++) {
    const err = normalCdf(x, 0, 1) - p;
    x -= err / normalPdf(x, 0, 1);
  }

  return m + s * x;
}

// Canvas setup
function setupCanvas(canvas) {
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = Math.round(rect.width * dpr);
  canvas.height = Math.round(rect.height * dpr);
  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  return ctx;
}

// Draw PDF
function draw() {
  const ctx = setupCanvas(pdfCanvas);
  const rect = pdfCanvas.getBoundingClientRect();
  const w = rect.width, h = rect.height;
  ctx.clearRect(0, 0, w, h);

  const L = 50, R = 15, T = 15, B = 35;
  const plotW = w - L - R, plotH = h - T - B, yBase = h - B;

  // X range
  let xMin, xMax;
  if (xAxisMode === 'fixed') {
    xMin = fixedXMin; xMax = fixedXMax;
  } else {
    xMin = mu - 4 * sigma; xMax = mu + 4 * sigma;
  }

  // Y max
  let ymax;
  if (yAxisMode === 'fixed') {
    ymax = fixedYMax;
  } else {
    ymax = normalPdf(mu, mu, sigma) * 1.15;
  }

  // Grid
  ctx.strokeStyle = '#f0f0f0';
  ctx.lineWidth = 1;
  for (let i = 1; i < 5; i++) {
    const y = yBase - (i / 5) * plotH;
    ctx.beginPath(); ctx.moveTo(L, y); ctx.lineTo(w - R, y); ctx.stroke();
  }

  // Axes
  ctx.strokeStyle = '#ddd';
  ctx.lineWidth = 1.5;
  ctx.beginPath(); ctx.moveTo(L, yBase); ctx.lineTo(w - R, yBase); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(L, T); ctx.lineTo(L, yBase); ctx.stroke();

  // X labels
  ctx.font = '11px system-ui';
  ctx.fillStyle = '#888';
  ctx.textAlign = 'center';
  for (let i = 0; i <= 6; i++) {
    const xVal = xMin + (xMax - xMin) * i / 6;
    const x = L + i * plotW / 6;
    ctx.fillText(xVal.toFixed(1), x, h - 12);
  }

  // Y labels
  ctx.textAlign = 'right';
  for (let i = 0; i <= 4; i++) {
    const yVal = (i / 4) * ymax;
    const y = yBase - (i / 4) * plotH;
    ctx.fillText(yVal.toFixed(2), L - 8, y + 4);
  }

  // Fill area
  ctx.beginPath();
  ctx.moveTo(L, yBase);
  for (let i = 0; i <= 300; i++) {
    const xVal = xMin + (xMax - xMin) * i / 300;
    const x = L + (xVal - xMin) / (xMax - xMin) * plotW;
    const pdf = normalPdf(xVal, mu, sigma);
    const y = yBase - Math.min(pdf, ymax) / ymax * plotH;
    ctx.lineTo(x, y);
  }
  ctx.lineTo(L + plotW, yBase);
  ctx.closePath();
  ctx.fillStyle = 'rgba(239, 68, 68, 0.2)';
  ctx.fill();

  // Curve
  ctx.beginPath();
  for (let i = 0; i <= 300; i++) {
    const xVal = xMin + (xMax - xMin) * i / 300;
    const x = L + (xVal - xMin) / (xMax - xMin) * plotW;
    const pdf = normalPdf(xVal, mu, sigma);
    const y = yBase - Math.min(pdf, ymax) / ymax * plotH;
    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
  }
  ctx.strokeStyle = '#ef4444';
  ctx.lineWidth = 2.5;
  ctx.stroke();

  // Mean line
  const xMu = L + (mu - xMin) / (xMax - xMin) * plotW;
  if (xMu >= L && xMu <= w - R) {
    ctx.beginPath();
    ctx.moveTo(xMu, yBase);
    ctx.lineTo(xMu, yBase - Math.min(normalPdf(mu, mu, sigma), ymax) / ymax * plotH);
    ctx.strokeStyle = '#666';
    ctx.lineWidth = 1.5;
    ctx.setLineDash([4, 4]);
    ctx.stroke();
    ctx.setLineDash([]);

    ctx.fillStyle = '#666';
    ctx.textAlign = 'center';
    ctx.fillText('Œº', xMu, yBase + 22);
  }
}

// Sync UI
function sync(newMu, newSigma) {
  mu = parseFloat(newMu) || 0;
  sigma = parseFloat(newSigma) || 1;
  sigma = Math.max(0.1, sigma);

  muSlider.value = Math.max(-4, Math.min(4, mu));
  muNum.value = mu;
  sigmaSlider.value = Math.max(0.3, Math.min(3, sigma));
  sigmaNum.value = sigma;

  document.getElementById('muOut').textContent = mu.toFixed(1);
  document.getElementById('sigmaOut').textContent = sigma.toFixed(1);
  document.getElementById('varOut').textContent = (sigma * sigma).toFixed(2);
  document.getElementById('range68').textContent = `[${(mu - sigma).toFixed(1)}, ${(mu + sigma).toFixed(1)}]`;
  document.getElementById('range95').textContent = `[${(mu - 2*sigma).toFixed(1)}, ${(mu + 2*sigma).toFixed(1)}]`;

  draw();

  // Update calculator results
  calcDnorm();
  calcPnorm();
  calcQnorm();
}

// Calculator functions
function calcDnorm() {
  const x = parseFloat(document.getElementById('dnorm_x').value) || 0;
  const result = normalPdf(x, mu, sigma);
  document.getElementById('dnorm_result').textContent = result.toFixed(6);
}

function calcPnorm() {
  const x = parseFloat(document.getElementById('pnorm_x').value) || 0;
  const result = normalCdf(x, mu, sigma);
  document.getElementById('pnorm_result').textContent = result.toFixed(6);
}

function calcQnorm() {
  const p = parseFloat(document.getElementById('qnorm_p').value) || 0.5;
  const result = normalQuantile(p, mu, sigma);
  document.getElementById('qnorm_result').textContent = result.toFixed(6);
}

// Event listeners
muSlider.addEventListener('input', e => sync(e.target.value, sigma));
muNum.addEventListener('input', e => sync(e.target.value, sigma));
sigmaSlider.addEventListener('input', e => sync(mu, e.target.value));
sigmaNum.addEventListener('input', e => sync(mu, e.target.value));

document.getElementById('xAuto').addEventListener('click', () => {
  xAxisMode = 'auto';
  document.getElementById('xAuto').classList.add('active');
  document.getElementById('xFixed').classList.remove('active');
  draw();
});
document.getElementById('xFixed').addEventListener('click', () => {
  xAxisMode = 'fixed';
  document.getElementById('xFixed').classList.add('active');
  document.getElementById('xAuto').classList.remove('active');
  draw();
});
document.getElementById('yAuto').addEventListener('click', () => {
  yAxisMode = 'auto';
  document.getElementById('yAuto').classList.add('active');
  document.getElementById('yFixed').classList.remove('active');
  draw();
});
document.getElementById('yFixed').addEventListener('click', () => {
  yAxisMode = 'fixed';
  document.getElementById('yFixed').classList.add('active');
  document.getElementById('yAuto').classList.remove('active');
  draw();
});

// Examples
document.querySelectorAll('.example-item').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.example-item').forEach(el => el.classList.remove('active'));
    item.classList.add('active');
    sync(item.dataset.mu, item.dataset.sigma);
  });
});

// Calculator input listeners
document.getElementById('dnorm_x').addEventListener('input', calcDnorm);
document.getElementById('pnorm_x').addEventListener('input', calcPnorm);
document.getElementById('qnorm_p').addEventListener('input', calcQnorm);

window.addEventListener('resize', draw);

// Init
sync(0, 1);
</script>
</body>
</html>
