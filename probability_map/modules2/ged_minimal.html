<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>GED â€“ Generalized Error Distribution</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}]});"></script>
  <style>
    :root{ --bg:#f5f7f9; --panel:#ffffff; --ink:#111; --muted:#555; --border:#dcdcdc; --accent:#8b5cf6; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial; color:var(--ink); background:var(--bg)}
    header{padding:10px 18px; background:#8b5cf6; color:#fff; font-weight:600}
    .wrap{max-width:1100px; margin:14px auto; padding:0 14px; display:grid; grid-template-columns: 340px 1fr; grid-template-rows: auto auto; gap:14px}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:12px}
    .row{display:flex; align-items:center; gap:10px; margin:6px 0; flex-wrap:wrap}
    label{min-width:24px; color:#333; font-weight:600}
    input[type="range"]{width:120px}
    input[type="number"]{width:70px; padding:6px 8px; border:1px solid var(--border); border-radius:8px}
    .kblock{background:#fff; border:1px solid var(--border); border-radius:10px; padding:10px; margin-top:10px}
    .note{color:var(--muted); font-size:13px}
    .plot-card{grid-column: 2; grid-row: 1 / 3;}
    .plot{background:#fff; border:1px solid var(--border); border-radius:12px; padding:10px}
    .plot h3{margin:0 0 6px 0; font-size:14px}
    canvas{width:100%; height:320px; display:block; background:#fafafa; border-radius:8px}
    
    /* Axis controls */
    .axis-controls{display:flex; gap:16px; margin-top:10px; justify-content:center; flex-wrap:wrap}
    .axis-btn-group{display:flex; align-items:center; gap:6px; font-size:12px; color:var(--muted)}
    .axis-btn{padding:3px 8px; border:1px solid var(--border); background:#fff; border-radius:4px; font-size:11px; cursor:pointer; transition:all 0.2s}
    .axis-btn.active{background:var(--accent); color:#fff; border-color:var(--accent)}
    .axis-btn:hover:not(.active){background:#f3f4f6}
    
    /* Examples panel */
    .examples-card{grid-column:1; grid-row:2}
    .examples-card h4{font-size:13px; color:var(--accent); margin:0 0 8px 0; display:flex; align-items:center; gap:6px}
    .example-list{font-size:12px}
    .example-item{padding:8px; border-radius:6px; margin-bottom:6px; cursor:pointer; border:1px solid var(--border); transition:all 0.2s}
    .example-item:hover{background:#f8f7ff; border-color:var(--accent)}
    .example-item.active{background:#f3f0ff; border-color:var(--accent)}
    .example-item .ex-title{font-weight:600; color:var(--ink); margin-bottom:2px}
    .example-item .ex-params{color:var(--accent); font-family:monospace}
    
    /* Stats bar */
    .stats-bar{display:flex; justify-content:center; gap:20px; padding:10px; background:#f8f7ff; border-radius:8px; margin-top:10px; font-size:13px}
    .stat-item{text-align:center}
    .stat-label{color:var(--muted); font-size:11px}
    .stat-value{font-weight:600; color:var(--accent)}
    
    @media (max-width: 900px){ 
      .wrap{grid-template-columns: 1fr; grid-template-rows: auto auto auto} 
      .plot-card{grid-column:1; grid-row:2}
      .examples-card{grid-column:1; grid-row:3}
    }
  </style>
</head>
<body>
<header>Generalized Error Distribution (GED)</header>
<main class="wrap">
  <!-- Parameters Panel -->
  <section class="card">
    <div class="row">
      <label>$\mu$</label>
      <input id="mu" type="range" min="-3" max="3" step="0.1" value="0">
      <input id="muNum" type="number" min="-5" max="5" step="0.1" value="0">
      <span class="note">(location)</span>
    </div>
    <div class="row">
      <label>$\alpha$</label>
      <input id="alpha" type="range" min="0.3" max="3" step="0.1" value="1">
      <input id="alphaNum" type="number" min="0.1" max="5" step="0.1" value="1">
      <span class="note">(scale)</span>
    </div>
    <div class="row">
      <label>$\beta$</label>
      <input id="beta" type="range" min="0.5" max="5" step="0.1" value="2">
      <input id="betaNum" type="number" min="0.3" max="10" step="0.1" value="2">
      <span class="note">(shape)</span>
    </div>

    <div class="kblock">
      <div class="note" style="font-weight:600; margin-bottom:6px">Probability Density Function</div>
      <div style="text-align:center; padding:8px 0">
        $$f(x) = \frac{\beta}{2\alpha\Gamma(1/\beta)} \exp\left(-\left|\frac{x-\mu}{\alpha}\right|^\beta\right)$$
      </div>
    </div>

    <div class="kblock">
      <div class="note" style="font-weight:600; margin-bottom:6px">Key Properties</div>
      <table style="width:100%; font-size:12px; border-collapse:collapse">
        <tr><td style="padding:4px 0; color:var(--muted)">Support</td><td>$x \in (-\infty, +\infty)$</td></tr>
        <tr><td style="padding:4px 0; color:var(--muted)">Mean</td><td>$E[X] = \mu$</td></tr>
        <tr><td style="padding:4px 0; color:var(--muted)">Variance</td><td>$\text{Var}[X] = \alpha^2 \frac{\Gamma(3/\beta)}{\Gamma(1/\beta)}$</td></tr>
      </table>
    </div>

    <div class="kblock">
      <div class="note" style="font-weight:600; margin-bottom:6px">Special Cases</div>
      <ul class="note" style="margin:4px 0 0 16px; font-size:12px">
        <li>$\beta = 1$: Laplace (Double Exponential)</li>
        <li>$\beta = 2$: Normal (Gaussian)</li>
        <li>$\beta \to \infty$: Uniform</li>
      </ul>
    </div>
  </section>

  <!-- Plot Panel -->
  <section class="card plot-card">
    <div class="plot">
      <h3>PDF $f(x)$</h3>
      <canvas id="pdf"></canvas>
      <div class="axis-controls">
        <div class="axis-btn-group">
          <span>x-axis:</span>
          <button class="axis-btn active" id="xAuto">Auto</button>
          <button class="axis-btn" id="xFixed">Fixed</button>
        </div>
        <div class="axis-btn-group">
          <span>y-axis:</span>
          <button class="axis-btn active" id="yAuto">Auto</button>
          <button class="axis-btn" id="yFixed">Fixed</button>
        </div>
      </div>
      <div class="stats-bar">
        <div class="stat-item">
          <div class="stat-label">$\mu$</div>
          <div class="stat-value" id="muOut">0.0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">$\alpha$</div>
          <div class="stat-value" id="alphaOut">1.0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">$\beta$</div>
          <div class="stat-value" id="betaOut">2.0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">$E[X]$</div>
          <div class="stat-value" id="meanOut">0.000</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">$\text{Var}[X]$</div>
          <div class="stat-value" id="varOut">0.500</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Examples Panel -->
  <section class="card examples-card">
    <h4>ðŸ“š Examples</h4>
    <div class="example-list">
      <div class="example-item" data-mu="0" data-alpha="1" data-beta="2">
        <div class="ex-title">Standard Normal</div>
        <div class="ex-params">Î¼=0, Î±=1, Î²=2</div>
        <div class="note">Classic bell curve, the most common distribution in statistics.</div>
      </div>
      <div class="example-item" data-mu="0" data-alpha="1" data-beta="1">
        <div class="ex-title">Laplace Distribution</div>
        <div class="ex-params">Î¼=0, Î±=1, Î²=1</div>
        <div class="note">Double exponential; sharper peak, heavier tails than Normal.</div>
      </div>
      <div class="example-item" data-mu="0" data-alpha="1" data-beta="0.7">
        <div class="ex-title">Fat-tailed (Financial)</div>
        <div class="ex-params">Î¼=0, Î±=1, Î²=0.7</div>
        <div class="note">Models stock returns with extreme events (fat tails).</div>
      </div>
      <div class="example-item" data-mu="0" data-alpha="1" data-beta="4">
        <div class="ex-title">Thin-tailed</div>
        <div class="ex-params">Î¼=0, Î±=1, Î²=4</div>
        <div class="note">Flatter top, thinner tails; approaches Uniform as Î²â†’âˆž.</div>
      </div>
    </div>
  </section>
</main>

<script>
// DOM Elements
const muSlider = document.getElementById('mu');
const muNum = document.getElementById('muNum');
const alphaSlider = document.getElementById('alpha');
const alphaNum = document.getElementById('alphaNum');
const betaSlider = document.getElementById('beta');
const betaNum = document.getElementById('betaNum');
const pdfCanvas = document.getElementById('pdf');

// Axis mode: 'auto' or 'fixed'
let xAxisMode = 'auto', yAxisMode = 'auto';
let fixedXMin = -6, fixedXMax = 6, fixedYMax = 1.0;

// Gamma function (Lanczos approximation)
function gamma(z) {
  if (z < 0.5) return Math.PI / (Math.sin(Math.PI * z) * gamma(1 - z));
  z -= 1;
  const g = 7;
  const c = [0.99999999999980993, 676.5203681218851, -1259.1392167224028, 771.32342877765313,
    -176.61502916214059, 12.507343278686905, -0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7];
  let x = c[0];
  for (let i = 1; i < g + 2; i++) x += c[i] / (z + i);
  const t = z + g + 0.5;
  return Math.sqrt(2 * Math.PI) * Math.pow(t, z + 0.5) * Math.exp(-t) * x;
}

// GED PDF
function gedPdf(x, mu, alpha, beta) {
  const z = Math.abs(x - mu) / alpha;
  return beta / (2 * alpha * gamma(1/beta)) * Math.exp(-Math.pow(z, beta));
}

// Canvas setup
function setupCanvas(canvas) {
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = Math.round(rect.width * dpr);
  canvas.height = Math.round(rect.height * dpr);
  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  return ctx;
}

// Draw function
function draw(mu, alpha, beta) {
  const ctx = setupCanvas(pdfCanvas);
  const rect = pdfCanvas.getBoundingClientRect();
  const w = rect.width, h = rect.height;
  ctx.clearRect(0, 0, w, h);

  const L = 50, R = 15, T = 15, B = 35;
  const plotW = w - L - R;
  const plotH = h - T - B;
  const yBase = h - B;

  // Determine x range
  let xMin, xMax;
  if (xAxisMode === 'fixed') {
    xMin = fixedXMin;
    xMax = fixedXMax;
  } else {
    xMin = mu - 5 * alpha;
    xMax = mu + 5 * alpha;
  }

  // Compute y max
  let ymax;
  if (yAxisMode === 'fixed') {
    ymax = fixedYMax;
  } else {
    ymax = 0;
    for (let i = 0; i <= 200; i++) {
      const xVal = xMin + (xMax - xMin) * i / 200;
      const pdf = gedPdf(xVal, mu, alpha, beta);
      if (pdf > ymax) ymax = pdf;
    }
    ymax *= 1.15;
  }

  // Draw grid
  ctx.strokeStyle = '#f0f0f0';
  ctx.lineWidth = 1;
  for (let i = 1; i < 5; i++) {
    const y = yBase - (i / 5) * plotH;
    ctx.beginPath(); ctx.moveTo(L, y); ctx.lineTo(w - R, y); ctx.stroke();
  }

  // Axes
  ctx.strokeStyle = '#e0e0e0';
  ctx.lineWidth = 1.5;
  ctx.beginPath(); ctx.moveTo(L, yBase); ctx.lineTo(w - R, yBase); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(L, T); ctx.lineTo(L, yBase); ctx.stroke();

  // X-axis labels
  ctx.font = '11px system-ui, sans-serif';
  ctx.fillStyle = '#777';
  ctx.textAlign = 'center';
  const xStep = (xMax - xMin) / 6;
  for (let i = 0; i <= 6; i++) {
    const xVal = xMin + i * xStep;
    const x = L + i * plotW / 6;
    ctx.fillText(xVal.toFixed(1), x, h - 12);
  }

  // Y-axis labels
  ctx.textAlign = 'right';
  for (let i = 0; i <= 4; i++) {
    const yVal = (i / 4) * ymax;
    const y = yBase - (i / 4) * plotH;
    ctx.fillText(yVal.toFixed(2), L - 8, y + 4);
  }

  // Draw filled area
  ctx.beginPath();
  ctx.moveTo(L, yBase);
  const steps = 300;
  for (let i = 0; i <= steps; i++) {
    const xVal = xMin + (xMax - xMin) * i / steps;
    const x = L + (xVal - xMin) / (xMax - xMin) * plotW;
    const pdf = gedPdf(xVal, mu, alpha, beta);
    const y = yBase - Math.min(pdf, ymax) / ymax * plotH;
    ctx.lineTo(x, y);
  }
  ctx.lineTo(L + plotW, yBase);
  ctx.closePath();
  ctx.fillStyle = 'rgba(139, 92, 246, 0.2)';
  ctx.fill();

  // Draw curve
  ctx.beginPath();
  for (let i = 0; i <= steps; i++) {
    const xVal = xMin + (xMax - xMin) * i / steps;
    const x = L + (xVal - xMin) / (xMax - xMin) * plotW;
    const pdf = gedPdf(xVal, mu, alpha, beta);
    const y = yBase - Math.min(pdf, ymax) / ymax * plotH;
    if (i === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  }
  ctx.strokeStyle = '#8b5cf6';
  ctx.lineWidth = 2.5;
  ctx.stroke();

  // Draw vertical line at mu
  const xMu = L + (mu - xMin) / (xMax - xMin) * plotW;
  if (xMu >= L && xMu <= w - R) {
    ctx.beginPath();
    ctx.moveTo(xMu, yBase);
    const pdfAtMu = gedPdf(mu, mu, alpha, beta);
    ctx.lineTo(xMu, yBase - Math.min(pdfAtMu, ymax) / ymax * plotH);
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 1.5;
    ctx.setLineDash([4, 4]);
    ctx.stroke();
    ctx.setLineDash([]);

    // Label Î¼
    ctx.fillStyle = '#333';
    ctx.font = '12px system-ui';
    ctx.textAlign = 'center';
    ctx.fillText('Î¼', xMu, yBase + 22);
  }
}

// Sync function
function sync(mu, alpha, beta) {
  mu = parseFloat(mu);
  alpha = parseFloat(alpha);
  beta = parseFloat(beta);

  if (!Number.isFinite(mu)) mu = 0;
  if (!Number.isFinite(alpha)) alpha = 1;
  if (!Number.isFinite(beta)) beta = 2;

  mu = Math.max(-5, Math.min(5, mu));
  alpha = Math.max(0.1, Math.min(5, alpha));
  beta = Math.max(0.3, Math.min(10, beta));

  muSlider.value = mu;
  muNum.value = mu;
  alphaSlider.value = alpha;
  alphaNum.value = alpha;
  betaSlider.value = beta;
  betaNum.value = beta;

  document.getElementById('muOut').textContent = mu.toFixed(1);
  document.getElementById('alphaOut').textContent = alpha.toFixed(1);
  document.getElementById('betaOut').textContent = beta.toFixed(1);

  const variance = alpha * alpha * gamma(3/beta) / gamma(1/beta);
  document.getElementById('meanOut').textContent = mu.toFixed(3);
  document.getElementById('varOut').textContent = variance.toFixed(3);

  draw(mu, alpha, beta);
}

// Event listeners for sliders
muSlider.addEventListener('input', e => sync(e.target.value, alphaSlider.value, betaSlider.value));
muNum.addEventListener('input', e => sync(e.target.value, alphaSlider.value, betaSlider.value));
alphaSlider.addEventListener('input', e => sync(muSlider.value, e.target.value, betaSlider.value));
alphaNum.addEventListener('input', e => sync(muSlider.value, e.target.value, betaSlider.value));
betaSlider.addEventListener('input', e => sync(muSlider.value, alphaSlider.value, e.target.value));
betaNum.addEventListener('input', e => sync(muSlider.value, alphaSlider.value, e.target.value));

// Axis toggle buttons
document.getElementById('xAuto').addEventListener('click', () => {
  xAxisMode = 'auto';
  document.getElementById('xAuto').classList.add('active');
  document.getElementById('xFixed').classList.remove('active');
  sync(muSlider.value, alphaSlider.value, betaSlider.value);
});
document.getElementById('xFixed').addEventListener('click', () => {
  xAxisMode = 'fixed';
  document.getElementById('xFixed').classList.add('active');
  document.getElementById('xAuto').classList.remove('active');
  sync(muSlider.value, alphaSlider.value, betaSlider.value);
});
document.getElementById('yAuto').addEventListener('click', () => {
  yAxisMode = 'auto';
  document.getElementById('yAuto').classList.add('active');
  document.getElementById('yFixed').classList.remove('active');
  sync(muSlider.value, alphaSlider.value, betaSlider.value);
});
document.getElementById('yFixed').addEventListener('click', () => {
  yAxisMode = 'fixed';
  document.getElementById('yFixed').classList.add('active');
  document.getElementById('yAuto').classList.remove('active');
  sync(muSlider.value, alphaSlider.value, betaSlider.value);
});

// Example items
document.querySelectorAll('.example-item').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.example-item').forEach(el => el.classList.remove('active'));
    item.classList.add('active');
    const mu = parseFloat(item.dataset.mu);
    const alpha = parseFloat(item.dataset.alpha);
    const beta = parseFloat(item.dataset.beta);
    sync(mu, alpha, beta);
  });
});

// Resize handler
window.addEventListener('resize', () => sync(muSlider.value, alphaSlider.value, betaSlider.value));

// Initial render
sync(0, 1, 2);
</script>
</body>
</html>
