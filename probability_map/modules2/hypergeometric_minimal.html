<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Hypergeometric — Minimal Interactive Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root{ --bg:#f5f7f9; --panel:#ffffff; --ink:#111; --muted:#555; --border:#dcdcdc; --accent:#0ea5e9; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial; color:var(--ink); background:var(--bg)}
    header{padding:10px 18px; background:#2563eb; color:#fff; font-weight:600}
    .wrap{max-width:1000px; margin:14px auto; padding:0 14px; display:grid; grid-template-columns: 320px 1fr; gap:14px}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:12px}
    .row{display:flex; align-items:center; gap:10px; margin:6px 0; flex-wrap:wrap}
    label{min-width:18px; color:#333; font-weight:600}
    input[type="range"]{width:160px}
    input[type="number"]{width:90px; padding:6px 8px; border:1px solid var(--border); border-radius:8px}
    .kblock{background:#fff; border:1px solid var(--border); border-radius:10px; padding:10px; margin-top:10px}
    .note{color:var(--muted); font-size:13px}
    .plot{background:#fff; border:1px solid var(--border); border-radius:12px; padding:10px}
    .plot h3{margin:0 0 6px 0; font-size:14px}
    canvas{width:100%; height:280px; display:block; background:#fafafa; border-radius:8px}
    @media (max-width: 900px){ .wrap{grid-template-columns: 1fr} }
  </style>
</head>
<body>
<header>Hypergeometric</header>
<main class="wrap">
  <section class="card">
    <div class="row">
      <label for="N">N</label>
      <input id="N" type="range" min="10" max="80" step="1" value="50">
      <input id="NNum" type="number" min="1" max="80" step="1" value="50">
      <span class="note">(population size)</span>
    </div>
    <div class="row">
      <label for="K">K</label>
      <input id="K" type="range" min="0" max="80" step="1" value="20">
      <input id="KNum" type="number" min="0" max="80" step="1" value="20">
      <span class="note">(number of successes in population)</span>
    </div>
    <div class="row">
      <label for="n">n</label>
      <input id="n" type="range" min="1" max="40" step="1" value="10">
      <input id="nNum" type="number" min="1" max="80" step="1" value="10">
      <span class="note">(sample size)</span>
    </div>

    <div class="kblock">
      <div class="note">Key facts</div>
      <ul class="note" style="margin:6px 0 0 16px">
        <li>Support: k = 0,1,…,min(K,n)</li>
        <li>PMF: P(X=k) = [C(K,k) C(N−K, n−k)] / C(N,n)</li>
        <li>Mean: E[X] = n (K/N)</li>
        <li>Variance: Var[X] = n (K/N)(1−K/N) ((N−n)/(N−1))</li>
        <li>Sampling without replacement from a finite population</li>
      </ul>
    </div>

    <div class="kblock">
      <div class="note">Parameters</div>
      <div class="note">
        N = <span id="NOut">50</span>,
        K = <span id="KOut">20</span>,
        n = <span id="nOut">10</span>
      </div>
      <div class="note">
        E[X] = <span id="meanOut">4.000</span>,
        Var[X] = <span id="varOut">2.939</span>
      </div>
    </div>
  </section>

  <section class="card">
    <div class="plot">
      <h3>PMF</h3>
      <canvas id="pmf"></canvas>
    </div>
  </section>
</main>

<script>
const NSlider = document.getElementById('N');
const NNum = document.getElementById('NNum');
const KSlider = document.getElementById('K');
const KNum = document.getElementById('KNum');
const nSlider = document.getElementById('n');
const nNum = document.getElementById('nNum');

const NOut = document.getElementById('NOut');
const KOut = document.getElementById('KOut');
const nOut = document.getElementById('nOut');
const meanOut = document.getElementById('meanOut');
const varOut = document.getElementById('varOut');
const pmfCanvas = document.getElementById('pmf');

function setupCanvas(canvas){
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = Math.round(rect.width * dpr);
  canvas.height = Math.round(rect.height * dpr);
  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  return ctx;
}

function comb(n, k){
  if(k < 0 || k > n) return 0;
  k = Math.min(k, n - k);
  let res = 1;
  for(let i = 1; i <= k; i++){
    res *= (n - k + i) / i;
  }
  return res;
}

function hypergeomPmf(k, N, K, n){
  const denom = comb(N, n);
  if(denom === 0) return 0;
  return comb(K, k) * comb(N - K, n - k) / denom;
}

function drawPMF(N, K, n){
  const ctx = setupCanvas(pmfCanvas);
  const rect = pmfCanvas.getBoundingClientRect();
  const w = rect.width, h = rect.height;

  ctx.clearRect(0, 0, w, h);

  const L = 50, R = 10, T = 10, B = 24;
  const plotW = w - L - R;
  const plotH = h - T - B;
  const yBase = h - B;

  const kMin = Math.max(0, n - (N - K));
  const kMax = Math.min(n, K);
  const m = kMax - kMin + 1;
  if(m <= 0) return;

  const probs = [];
  let maxP = 0;
  for(let k = kMin; k <= kMax; k++){
    const p = hypergeomPmf(k, N, K, n);
    probs.push(p);
    if(p > maxP) maxP = p;
  }
  if(maxP <= 0) return;
  const ymax = maxP * 1.1;

  // axes
  ctx.strokeStyle = '#e6e6e6';
  ctx.lineWidth = 1;
  ctx.beginPath(); ctx.moveTo(40, yBase); ctx.lineTo(w - 10, yBase); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(40, 10); ctx.lineTo(40, h - 10); ctx.stroke();

  const barW = Math.min(26, plotW / (m * 1.4));
  const showValues = m <= 20;

  for(let i = 0; i < m; i++){
    const k = kMin + i;
    const p = probs[i];
    const xCenter = L + (i + 0.5) * plotW / m;
    const barHeight = p * plotH / ymax;
    const x = xCenter - barW / 2;
    const y = yBase - barHeight;

    ctx.fillStyle = '#0ea5e9';
    ctx.fillRect(x, y, barW, barHeight);

    ctx.font = '12px system-ui, sans-serif';
    if(showValues){
      ctx.fillStyle = '#333';
      ctx.fillText(p.toFixed(3), xCenter - 16, y - 4);
    }
    ctx.fillStyle = '#777';
    ctx.fillText(String(k), xCenter - 4, h - 6);
  }
}

function syncHyper(N, K, n){
  N = parseInt(N, 10);
  K = parseInt(K, 10);
  n = parseInt(n, 10);

  if(!Number.isFinite(N)) N = 50;
  if(!Number.isFinite(K)) K = 20;
  if(!Number.isFinite(n)) n = 10;

  if(N < 1) N = 1;
  if(N > 80) N = 80;

  if(K < 0) K = 0;
  if(K > N) K = N;

  if(n < 0) n = 0;
  if(n > N) n = N;

  NSlider.value = N;
  NNum.value = N;
  KSlider.value = K;
  KNum.value = K;
  nSlider.value = Math.min(n, parseInt(nSlider.max, 10));
  nNum.value = n;

  NOut.textContent = String(N);
  KOut.textContent = String(K);
  nOut.textContent = String(n);

  const p = N > 0 ? K / N : 0;
  const mean = n * p;
  let variance = 0;
  if(N > 1){
    variance = n * p * (1 - p) * ((N - n) / (N - 1));
  }
  meanOut.textContent = mean.toFixed(3);
  varOut.textContent = variance.toFixed(3);

  drawPMF(N, K, n);
}

NSlider.addEventListener('input', e => syncHyper(e.target.value, KSlider.value, nSlider.value));
NNum.addEventListener('input', e => syncHyper(e.target.value, KSlider.value, nSlider.value));
KSlider.addEventListener('input', e => syncHyper(NSlider.value, e.target.value, nSlider.value));
KNum.addEventListener('input', e => syncHyper(NSlider.value, e.target.value, nSlider.value));
nSlider.addEventListener('input', e => syncHyper(NSlider.value, KSlider.value, e.target.value));
nNum.addEventListener('input', e => syncHyper(NSlider.value, KSlider.value, e.target.value));

window.addEventListener('resize', () => syncHyper(NSlider.value, KSlider.value, nSlider.value));

// initial
syncHyper(50, 20, 10);
</script>
</body>
</html>
