<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Weibull – Minimal Interactive Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root{ --bg:#f5f7f9; --panel:#ffffff; --ink:#111; --muted:#555; --border:#dcdcdc; --accent:#ec4899; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial; color:var(--ink); background:var(--bg)}
    header{padding:10px 18px; background:#ec4899; color:#fff; font-weight:600}
    .wrap{max-width:1000px; margin:14px auto; padding:0 14px; display:grid; grid-template-columns: 320px 1fr; gap:14px}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:12px}
    .row{display:flex; align-items:center; gap:10px; margin:6px 0; flex-wrap:wrap}
    label{min-width:16px; color:#333; font-weight:600}
    input[type="range"]{width:140px}
    input[type="number"]{width:70px; padding:6px 8px; border:1px solid var(--border); border-radius:8px}
    .kblock{background:#fff; border:1px solid var(--border); border-radius:10px; padding:10px; margin-top:10px}
    .note{color:var(--muted); font-size:13px}
    .plot{background:#fff; border:1px solid var(--border); border-radius:12px; padding:10px}
    .plot h3{margin:0 0 6px 0; font-size:14px}
    canvas{width:100%; height:280px; display:block; background:#fafafa; border-radius:8px}
    @media (max-width: 900px){ .wrap{grid-template-columns: 1fr} }
  </style>
</head>
<body>
<header>Weibull Distribution X ~ Weibull(α, β)</header>
<main class="wrap">
  <section class="card">
    <div class="row">
      <label for="alpha">α</label>
      <input id="alpha" type="range" min="0.5" max="5" step="0.1" value="1.5">
      <input id="alphaNum" type="number" min="0.5" max="5" step="0.1" value="1.5">
      <span class="note">(shape parameter)</span>
    </div>
    <div class="row">
      <label for="beta">β</label>
      <input id="beta" type="range" min="0.5" max="5" step="0.1" value="1">
      <input id="betaNum" type="number" min="0.5" max="5" step="0.1" value="1">
      <span class="note">(scale parameter)</span>
    </div>

    <div class="kblock">
      <div class="note">Key facts</div>
      <ul class="note" style="margin:6px 0 0 16px">
        <li>Support: x ≥ 0</li>
        <li>PDF: f(x) = (α/β)(x/β)^(α−1) e^(−(x/β)^α)</li>
        <li>CDF: F(x) = 1 − e^(−(x/β)^α)</li>
        <li>Mean: E[X] = β Γ(1 + 1/α)</li>
        <li>α = 1: Exponential distribution</li>
        <li>α = 2: Rayleigh distribution</li>
        <li>Used in reliability/survival analysis</li>
      </ul>
    </div>

    <div class="kblock">
      <div class="note">Parameters</div>
      <div class="note">
        α = <span id="alphaOut">1.5</span>,
        β = <span id="betaOut">1.0</span>
      </div>
      <div class="note">
        E[X] ≈ <span id="meanOut">0.903</span>,
        Var[X] ≈ <span id="varOut">0.376</span>
      </div>
    </div>
  </section>

  <section class="card">
    <div class="plot">
      <h3>PDF f(x)</h3>
      <canvas id="pdf"></canvas>
    </div>
  </section>
</main>

<script>
const alphaSlider = document.getElementById('alpha');
const alphaNum = document.getElementById('alphaNum');
const betaSlider = document.getElementById('beta');
const betaNum = document.getElementById('betaNum');

const alphaOut = document.getElementById('alphaOut');
const betaOut = document.getElementById('betaOut');
const meanOut = document.getElementById('meanOut');
const varOut = document.getElementById('varOut');
const pdfCanvas = document.getElementById('pdf');

function setupCanvas(canvas){
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = Math.round(rect.width * dpr);
  canvas.height = Math.round(rect.height * dpr);
  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  return ctx;
}

// Gamma function approximation (Lanczos)
function gamma(z){
  if(z < 0.5){
    return Math.PI / (Math.sin(Math.PI * z) * gamma(1 - z));
  }
  z -= 1;
  const g = 7;
  const c = [0.99999999999980993, 676.5203681218851, -1259.1392167224028,
             771.32342877765313, -176.61502916214059, 12.507343278686905,
             -0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7];
  let x = c[0];
  for(let i = 1; i < g + 2; i++){
    x += c[i] / (z + i);
  }
  const t = z + g + 0.5;
  return Math.sqrt(2 * Math.PI) * Math.pow(t, z + 0.5) * Math.exp(-t) * x;
}

function weibullPdf(x, alpha, beta){
  if(x < 0) return 0;
  if(x === 0){
    if(alpha < 1) return Infinity;
    if(alpha === 1) return alpha / beta;
    return 0;
  }
  return (alpha / beta) * Math.pow(x / beta, alpha - 1) * Math.exp(-Math.pow(x / beta, alpha));
}

function draw(alpha, beta){
  const ctx = setupCanvas(pdfCanvas);
  const rect = pdfCanvas.getBoundingClientRect();
  const w = rect.width, h = rect.height;
  ctx.clearRect(0, 0, w, h);

  const L = 50, R = 10, T = 10, B = 24;
  const plotW = w - L - R;
  const plotH = h - T - B;
  const yBase = h - B;

  // Determine x range
  const xMin = 0;
  const xMax = beta * 4;
  
  // Find max PDF value for scaling
  const steps = 300;
  let maxPdf = 0;
  for(let i = 1; i <= steps; i++){
    const x = xMin + (xMax - xMin) * i / steps;
    const pdf = weibullPdf(x, alpha, beta);
    if(Number.isFinite(pdf) && pdf > maxPdf) maxPdf = pdf;
  }
  const ymax = maxPdf * 1.15;

  // axes
  ctx.strokeStyle = '#e6e6e6';
  ctx.lineWidth = 1;
  ctx.beginPath(); ctx.moveTo(L, yBase); ctx.lineTo(w - R, yBase); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(L, T); ctx.lineTo(L, yBase); ctx.stroke();

  // x-axis labels
  ctx.font = '11px system-ui, sans-serif';
  ctx.fillStyle = '#777';
  const tickCount = 5;
  for(let i = 0; i <= tickCount; i++){
    const xVal = xMin + (xMax - xMin) * i / tickCount;
    const x = L + i / tickCount * plotW;
    ctx.fillText(xVal.toFixed(1), x - 8, h - 6);
  }

  // Draw filled area
  ctx.beginPath();
  ctx.moveTo(L, yBase);
  for(let i = 0; i <= steps; i++){
    const xVal = xMin + (xMax - xMin) * i / steps;
    const x = L + (xVal - xMin) / (xMax - xMin) * plotW;
    let pdf = weibullPdf(xVal, alpha, beta);
    if(!Number.isFinite(pdf)) pdf = 0;
    const y = yBase - Math.min(pdf, ymax) / ymax * plotH;
    ctx.lineTo(x, y);
  }
  ctx.lineTo(L + plotW, yBase);
  ctx.closePath();
  ctx.fillStyle = 'rgba(236, 72, 153, 0.25)';
  ctx.fill();

  // Draw curve
  ctx.beginPath();
  let started = false;
  for(let i = 0; i <= steps; i++){
    const xVal = xMin + (xMax - xMin) * i / steps;
    const x = L + (xVal - xMin) / (xMax - xMin) * plotW;
    let pdf = weibullPdf(xVal, alpha, beta);
    if(!Number.isFinite(pdf) || pdf > ymax * 2) continue;
    const y = yBase - Math.min(pdf, ymax) / ymax * plotH;
    if(!started){
      ctx.moveTo(x, y);
      started = true;
    } else {
      ctx.lineTo(x, y);
    }
  }
  ctx.strokeStyle = '#ec4899';
  ctx.lineWidth = 2.5;
  ctx.stroke();
}

function sync(alpha, beta){
  alpha = parseFloat(alpha);
  beta = parseFloat(beta);
  
  if(!Number.isFinite(alpha)) alpha = 1.5;
  if(!Number.isFinite(beta)) beta = 1;
  
  if(alpha < 0.5) alpha = 0.5;
  if(alpha > 5) alpha = 5;
  if(beta < 0.5) beta = 0.5;
  if(beta > 5) beta = 5;

  alphaSlider.value = alpha;
  alphaNum.value = alpha;
  betaSlider.value = beta;
  betaNum.value = beta;
  
  alphaOut.textContent = alpha.toFixed(1);
  betaOut.textContent = beta.toFixed(1);

  // E[X] = beta * Gamma(1 + 1/alpha)
  const mean = beta * gamma(1 + 1/alpha);
  // Var[X] = beta^2 * (Gamma(1 + 2/alpha) - Gamma(1 + 1/alpha)^2)
  const g1 = gamma(1 + 1/alpha);
  const g2 = gamma(1 + 2/alpha);
  const variance = beta * beta * (g2 - g1 * g1);
  
  meanOut.textContent = mean.toFixed(3);
  varOut.textContent = variance.toFixed(3);

  draw(alpha, beta);
}

alphaSlider.addEventListener('input', e => sync(e.target.value, betaSlider.value));
alphaNum.addEventListener('input', e => sync(e.target.value, betaSlider.value));
betaSlider.addEventListener('input', e => sync(alphaSlider.value, e.target.value));
betaNum.addEventListener('input', e => sync(alphaSlider.value, e.target.value));
window.addEventListener('resize', () => sync(alphaSlider.value, betaSlider.value));

sync(1.5, 1);
</script>
</body>
</html>
