<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Probability Distributions Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f7fa;
    overflow: hidden;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* --- Header Styling --- */
  header {
    background: white;
    padding: 0 24px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    border-bottom: 3px solid #3498db;
    z-index: 100;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 70px;
  }
  .header-left h1 {
    font-size: 22px;
    color: #2c3e50;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 0;
  }
  .header-left .subtitle {
    font-size: 12px;
    color: #7f8c8d;
    margin-top: 4px;
    font-weight: 400;
  }
  .header-right { display: flex; align-items: center; gap: 20px; }

  /* Legend */
  .type-legend-inline {
    display: flex;
    align-items: center;
    gap: 12px;
    background: #f8f9fa;
    padding: 6px 12px;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
  }
  .type-legend-title {
    font-size: 12px;
    font-weight: 700;
    color: #2c3e50;
    margin-right: 4px;
  }
  .type-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: #555;
    font-weight: 600;
  }
  .type-sample { width: 14px; height: 14px; border-radius: 4px; border: 2px solid; }
  .type-sample.discrete { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-color: #1976d2; }
  .type-sample.continuous { background: linear-gradient(135deg, #fff3e0 0%, #ffccbc 100%); border-color: #e64a19; }

  /* Buttons */
  .controls-inline { display: flex; gap: 8px; }
  .btn {
    padding: 6px 14px;
    background: white;
    border: 1.5px solid #bdc3c7;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    font-size: 12px;
    transition: all 0.2s ease;
    color: #2c3e50;
    display: flex;
    align-items: center;
    gap: 6px;
    height: 32px;
  }
  .btn:hover { background: #ecf0f1; border-color: #34495e; transform: translateY(-1px); }

  /* --- Canvas --- */
  #main-canvas { position: relative; width: 100%; flex: 1; overflow: hidden; background: white; }
  svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: all; }
  #nodes-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }

  /* --- Nodes --- */
  .node {
    position: absolute;
    padding: 10px 16px;
    background: white;
    border: 2.5px solid #2c3e50;
    pointer-events: auto;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.25s ease;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    font-weight: 700;
    font-size: 13px;
    color: #2c3e50;
    white-space: nowrap;
    user-select: none;
    transform: translate(-50%, -50%);
  }
  .node:hover { transform: translate(-50%, -50%) translateY(-3px) scale(1.05); border-color: #e74c3c; z-index: 100; }
  .node.highlighted {
    background: #fff9e6;
    border-color: #f39c12;
    border-width: 3px;
    box-shadow: 0 0 0 4px rgba(243, 156, 18, 0.25), 0 6px 20px rgba(0,0,0,0.2);
    z-index: 99;
  }
  .node.dimmed { opacity: 0.15; }
  .node.discrete { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-color: #1976d2; }
  .node.discrete:hover, .node.discrete.highlighted { border-color: #1976d2; }
  .node.continuous { background: linear-gradient(135deg, #fff3e0 0%, #ffccbc 100%); border-color: #e64a19; }
  .node.continuous:hover, .node.continuous.highlighted { border-color: #e64a19; }

  /* --- Lines --- */
  .connection-line { fill: none; stroke: #34495e; stroke-width: 2; opacity: 0.25; transition: all 0.25s ease; }
  .connection-line.solid { stroke-dasharray: none; }
  .connection-line.dashed { stroke-dasharray: 8 6; }
  .connection-line.dotted { stroke-dasharray: 3 6; }
  .connection-line.highlighted { stroke: #e74c3c; stroke-width: 3; opacity: 1; }
  .connection-line.clickable { cursor: pointer; }
  .connection-line.hovering { stroke: #9333ea; stroke-width: 4; opacity: 1; }
  .connection-hit-area { fill: none; stroke: transparent; stroke-width: 20; cursor: pointer; }

  .connection-label {
    fill: #2c3e50;
    font-size: 11px;
    font-weight: 600;
    text-anchor: middle;
    opacity: 0;
    transition: opacity 0.25s ease;
    pointer-events: none;
  }
  .connection-label.visible { opacity: 0.9; }
  .connection-label.highlighted { opacity: 1; fill: #e74c3c; font-weight: 700; }
  .label-bg { fill: white; opacity: 0.9; rx: 4; }

  /* Legend Bottom Left */
  .legend {
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: white;
    padding: 12px 16px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 200;
    border: 1px solid #eee;
  }
  .legend-title { font-weight: 700; margin-bottom: 8px; color: #2c3e50; font-size: 12px; text-transform: uppercase; }
  .legend-item { display: flex; align-items: center; gap: 12px; margin: 6px 0; font-size: 11px; color: #34495e; }
  .legend-line-sample { width: 30px; height: 2px; background: #34495e; }
  .legend-line-sample.dashed {
    background: repeating-linear-gradient(to right, #34495e 0px, #34495e 8px, transparent 8px, transparent 14px);
  }
  .legend-line-sample.dotted {
    background: repeating-linear-gradient(to right, #34495e 0px, #34495e 2px, transparent 2px, transparent 6px);
  }
</style>
</head>
<body>
  <header>
    <div class="header-left">
      <h1><span>üìä</span> Probability Distributions Map</h1>
      <div class="subtitle">Click node to highlight ¬∑ Double-click node/link for details</div>
    </div>

    <div class="header-right">
      <div class="type-legend-inline">
        <span class="type-legend-title">Types:</span>
        <div class="type-item"><div class="type-sample discrete"></div><span>Discrete</span></div>
        <div class="type-item"><div class="type-sample continuous"></div><span>Continuous</span></div>
      </div>

      <div class="controls-inline">
        <button class="btn" onclick="resetView()"><span>üîÑ</span> Reset</button>
        <button class="btn" onclick="toggleAllLabels()"><span>üè∑Ô∏è</span> Labels</button>
      </div>
    </div>
  </header>

  <div id="main-canvas">
    <svg id="connections-svg"></svg>
    <div id="nodes-layer"></div>
  </div>

  <div class="legend">
    <div class="legend-title">Relationships</div>
    <div class="legend-item"><div class="legend-line-sample"></div><span>Direct derivation</span></div>
    <div class="legend-item"><div class="legend-line-sample dashed"></div><span>Limiting case</span></div>
    <div class="legend-item"><div class="legend-line-sample dotted"></div><span>Special case</span></div>
  </div>

<script>
// --- 1. Nodes Configuration ---
const distributions = [
  // Discrete
  { id: 'bernoulli', name: 'Bernoulli(p)', type: 'discrete', xPercent: 15, yPercent: 20 },
  { id: 'binomial', name: 'Binomial(n, p)', type: 'discrete', xPercent: 35, yPercent: 20 },
  { id: 'geometric', name: 'Geometric(p)', type: 'discrete', xPercent: 15, yPercent: 45 },
  { id: 'negative_binomial', name: 'Negative Binomial(r, p)', type: 'discrete', xPercent: 35, yPercent: 45 },
  { id: 'hypergeometric', name: 'Hypergeometric(N, K, n)', type: 'discrete', xPercent: 15, yPercent: 70 },
  { id: 'poisson', name: 'Poisson(Œª)', type: 'discrete', xPercent: 35, yPercent: 70 },

  // Continuous
  { id: 'weibull', name: 'Weibull(k, Œª)', type: 'continuous', xPercent: 55, yPercent: 20 },
  { id: 'uniform', name: 'Uniform(a, b)', type: 'continuous', xPercent: 75, yPercent: 20 },
  { id: 'standard_uniform', name: 'Standard Uniform', type: 'continuous', xPercent: 92, yPercent: 20 },
  { id: 'normal', name: 'Normal(Œº, œÉ¬≤)', type: 'continuous', xPercent: 55, yPercent: 45 },
  { id: 'standard_normal', name: 'Standard Normal', type: 'continuous', xPercent: 75, yPercent: 45 },
  { id: 'lognormal', name: 'Lognormal(Œº, œÉ¬≤)', type: 'continuous', xPercent: 92, yPercent: 45 },
  { id: 'ged', name: 'GED(Œº, Œ±, Œ≤)', type: 'continuous', xPercent: 55, yPercent: 70 },
  { id: 'exponential', name: 'Exponential(Œª)', type: 'continuous', xPercent: 75, yPercent: 70 },
  { id: 'gamma', name: 'Gamma(Œ±, Œ≤)', type: 'continuous', xPercent: 92, yPercent: 70 },
  { id: 'chi_squared', name: 'Chi-Squared(ŒΩ)', type: 'continuous', xPercent: 85, yPercent: 90 }
];

// --- 2. File Links Mapping (modules folder) ---
const fileLinks = {
  'bernoulli': 'bernoulli_interactive_distribution.html',
  'binomial': 'binomial_interactive_distribution.html',
  'chi_squared': 'chi_square_interactive_distribution.html',
  'exponential': 'exponential_interactive_distribution.html',
  'gamma': 'gamma_interactive_distribution.html',
  'ged': 'ged_interactive_distribution.html',
  'geometric': 'geometric_interactive_distribution.html',
  'hypergeometric': 'hypergeometric_interactive_distribution.html',
  'lognormal': 'lognormal_interactive_distribution.html',
  'negative_binomial': 'negative_binomial_interactive_distribution.html',
  'normal': 'normal_interactive_distribution.html',
  'poisson': 'poisson_pmf_interactive.html',
  'standard_normal': 'standard_normal_interactive_distribution.html',
  'standard_uniform': 'standard_uniform_interactive_distribution.html',
  'uniform': 'uniform_interactive_distribution.html',
  'weibull': 'weibull_interactive_distribution.html'
};

// --- 3. Connections Configuration (relationship folder) ---
// IMPORTANT: Please verify these filenames match your actual files exactly!
const connections = [
  // Discrete
  { from: 'bernoulli', to: 'binomial', type: 'solid',  label: 'sum of n Bernoulli', link: 'relationship/bernoulli_to_binomial.html' },
  { from: 'geometric', to: 'negative_binomial', type: 'solid', label: 'sum of r Geometric', link: 'relationship/geometric_to_negativebinomial.html' },
  { from: 'hypergeometric', to: 'binomial', type: 'dashed', label: 'N‚Üí‚àû, K/N‚Üíp', link: 'relationship/hypergeometric_to_binomial.html' },
  { from: 'binomial', to: 'poisson', type: 'dashed', label: 'n‚Üí‚àû, p‚Üí0, np=Œª', link: 'relationship/binomial_to_poisson.html' },

  // Discrete to Continuous
  { from: 'binomial', to: 'normal', type: 'dashed', label: 'n large (CLT)', link: 'relationship/binomial_to_normal.html' },
  { from: 'poisson', to: 'normal', type: 'dashed', label: 'Œª‚Üí‚àû', link: 'relationship/poisson_to_normal.html' },

  // Poisson-Exponential
  { from: 'poisson', to: 'exponential', type: 'dotted', label: 'waiting time', link: 'relationship/poisson_to_exponential.html' },

  // Continuous
  { from: 'weibull', to: 'exponential', type: 'dotted', label: 'k=1', link: 'relationship/weibull_to_exponential.html' },
  { from: 'exponential', to: 'gamma', type: 'solid', label: 'sum of k Exp(Œª)', link: 'relationship/exponential_to_gamma.html' },
  { from: 'gamma', to: 'exponential', type: 'dotted', label: 'Œ±=1', link: 'relationship/gamma_to_exponential.html' },
  { from: 'gamma', to: 'chi_squared', type: 'dotted', label: 'Œ±=ŒΩ/2, Œ≤=1/2', link: 'relationship/gamma_to_chisquared.html' },

  // FIX 3: Standard Normal to Chi-Squared (reversed direction as in your latest snippet)
  { from: 'standard_normal', to: 'chi_squared', type: 'solid', label: 'sum of Z¬≤·µ¢', link: 'relationship/standard_normal_to_chi_squared.html' },

  // Normal family
  { from: 'normal', to: 'standard_normal', type: 'dotted', label: 'Z=(X-Œº)/œÉ', link: 'relationship/normal_to_standardnormal.html' },
  { from: 'normal', to: 'lognormal', type: 'solid', label: 'Y=exp(X)', link: 'relationship/normal_to_lognormal.html' },
  { from: 'normal', to: 'ged', type: 'dotted', label: 'Œ≤=2', link: 'relationship/normal_to_ged.html' },

  // Uniform family
  { from: 'uniform', to: 'standard_uniform', type: 'dotted', label: 'a=0, b=1', link: 'relationship/uniform_to_standarduniform.html' }
];

// --- Logic ---
let activeNode = null;
let showAllLabels = false;
const nodeElements = new Map();
let canvasWidth = 0;
let canvasHeight = 0;

const svg = document.getElementById('connections-svg');
const nodesLayer = document.getElementById('nodes-layer');

function setupCanvas() {
  const canvas = document.getElementById('main-canvas');
  canvasWidth = canvas.offsetWidth;
  canvasHeight = canvas.offsetHeight;
  svg.setAttribute('viewBox', `0 0 ${canvasWidth} ${canvasHeight}`);
  svg.style.width = canvasWidth + 'px';
  svg.style.height = canvasHeight + 'px';
}

function createNodes() {
  nodesLayer.innerHTML = '';
  nodeElements.clear();

  distributions.forEach(dist => {
    const node = document.createElement('div');
    node.className = `node ${dist.type}`;
    node.textContent = dist.name;

    const x = (canvasWidth * dist.xPercent) / 100;
    const y = (canvasHeight * dist.yPercent) / 100;
    node.style.left = x + 'px';
    node.style.top = y + 'px';
    node.dataset.id = dist.id;

    node.addEventListener('click', (e) => {
      e.stopPropagation();
      if (activeNode === dist.id) resetView();
      else { activeNode = dist.id; highlightNode(dist.id); }
    });

    node.addEventListener('dblclick', (e) => {
      e.stopPropagation();
      const fileName = fileLinks[dist.id];
      if (fileName) window.location.href = './modules/' + fileName;
    });

    node.addEventListener('mouseenter', () => { if (!activeNode) previewNode(dist.id); });
    node.addEventListener('mouseleave', () => { if (!activeNode) clearPreview(); });

    nodesLayer.appendChild(node);
    nodeElements.set(dist.id, node);
  });
}

function getNodeCenter(nodeId) {
  const node = nodeElements.get(nodeId);
  if (!node) return null;
  const rect = node.getBoundingClientRect();
  const canvasRect = document.getElementById('main-canvas').getBoundingClientRect();
  return { x: rect.left + rect.width/2 - canvasRect.left, y: rect.top + rect.height/2 - canvasRect.top };
}

function drawConnections(highlightSet = null) {
  svg.innerHTML = '';
  connections.forEach(conn => {
    const fromPos = getNodeCenter(conn.from);
    const toPos = getNodeCenter(conn.to);
    if (!fromPos || !toPos) return;

    const isHighlighted = highlightSet && highlightSet.has(conn.from) && highlightSet.has(conn.to);

    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');

    const dx = toPos.x - fromPos.x;
    const dy = toPos.y - fromPos.y;
    const dist = Math.sqrt(dx*dx + dy*dy) || 1;
    const curvature = Math.min(dist * 0.25, 60);
    const midX = (fromPos.x + toPos.x) / 2;
    const midY = (fromPos.y + toPos.y) / 2;
    const offsetX = -dy / dist * curvature;
    const offsetY =  dx / dist * curvature;
    const d = `M ${fromPos.x} ${fromPos.y} Q ${midX + offsetX} ${midY + offsetY} ${toPos.x} ${toPos.y}`;

    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    path.setAttribute('d', d);
    let className = `connection-line ${conn.type}`;
    if (isHighlighted) className += ' highlighted';
    if (conn.link) className += ' clickable';
    path.setAttribute('class', className);
    g.appendChild(path);

    // Label bg + text created before hover events so they exist
    const labelX = midX + offsetX;
    const labelY = midY + offsetY;

    const bg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
    bg.setAttribute('class', 'label-bg');
    g.appendChild(bg);

    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    text.textContent = conn.link ? 'üîó ' + conn.label : conn.label;
    text.setAttribute('x', labelX);
    text.setAttribute('y', labelY);

    let labelClass = 'connection-label';
    if (showAllLabels) labelClass += ' visible';
    if (isHighlighted) labelClass += ' highlighted visible';
    text.setAttribute('class', labelClass);
    g.appendChild(text);

    // Invisible hit area
    if (conn.link) {
      const hitArea = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      hitArea.setAttribute('d', d);
      hitArea.setAttribute('class', 'connection-hit-area');

      hitArea.addEventListener('dblclick', (e) => {
        e.stopPropagation();
        window.location.href = conn.link;
      });

      hitArea.addEventListener('mouseenter', () => {
        path.classList.add('hovering');
        text.classList.add('visible');
        bg.style.opacity = '0.9';
      });

      hitArea.addEventListener('mouseleave', () => {
        path.classList.remove('hovering');
        if (!showAllLabels && !isHighlighted) {
          text.classList.remove('visible');
          bg.style.opacity = '0';
        }
      });

      g.appendChild(hitArea);
    }

    svg.appendChild(g);

    requestAnimationFrame(() => {
      const bbox = text.getBBox();
      bg.setAttribute('x', bbox.x - 6);
      bg.setAttribute('y', bbox.y - 3);
      bg.setAttribute('width', bbox.width + 12);
      bg.setAttribute('height', bbox.height + 6);
      if (!showAllLabels && !isHighlighted) bg.style.opacity = '0';
    });
  });
}

function getRelatedNodes(nodeId) {
  const related = new Set([nodeId]);
  connections.forEach(conn => {
    if (conn.from === nodeId) related.add(conn.to);
    if (conn.to === nodeId) related.add(conn.from);
  });
  return related;
}

function highlightNode(nodeId) {
  const related = getRelatedNodes(nodeId);
  nodeElements.forEach((el, id) => {
    if (related.has(id)) { el.classList.add('highlighted'); el.classList.remove('dimmed'); }
    else { el.classList.remove('highlighted'); el.classList.add('dimmed'); }
  });
  drawConnections(related);
}

function previewNode(nodeId) {
  const related = getRelatedNodes(nodeId);
  nodeElements.forEach((el, id) => { if (related.has(id)) el.classList.add('highlighted'); });
  drawConnections(related);
}

function clearPreview() {
  nodeElements.forEach(el => el.classList.remove('highlighted'));
  drawConnections();
}

function resetView() {
  activeNode = null;
  nodeElements.forEach(el => el.classList.remove('highlighted', 'dimmed'));
  drawConnections();
}

function toggleAllLabels() {
  showAllLabels = !showAllLabels;
  if (activeNode) highlightNode(activeNode);
  else drawConnections();
}

document.getElementById('main-canvas').addEventListener('click', (e) => {
  if (e.target.id === 'main-canvas' || e.target.id === 'connections-svg') resetView();
});

function init() {
  setupCanvas();
  createNodes();
  drawConnections();
}

window.addEventListener('load', init);
window.addEventListener('resize', () => {
  setupCanvas();
  createNodes();
  if (activeNode) highlightNode(activeNode);
  else drawConnections();
});
</script>
</body>
</html>
